{"version":3,"sources":["../src/strategy.js"],"names":["DEFAULT_INDEX","DEFAULT_TEMPLATE","value","Strategy","props","cache","term","callback","match","searchWithCache","search","data","replace","results","text","index","template"],"mappings":";;;;;;;;;;AAQA,IAAMA,gBAAgB,CAAtB;;AAEA,SAASC,gBAAT,CAA0BC,KAA1B,EAAiC;AAC/B,SAAOA,KAAP;AACD;;AAED;;;;;;AAgBA;;;IAGqBC,Q;AAInB,oBAAYC,KAAZ,EAAuC;AAAA;;AACrC,SAAKA,KAAL,GAAaA,KAAb;AACA,SAAKC,KAAL,GAAaD,MAAMC,KAAN,GAAc,EAAd,GAAmB,IAAhC;AACD;;AAED;;;;;;;8BAGU;AACR,WAAKA,KAAL,GAAa,IAAb;AACA,aAAO,IAAP;AACD;;;2BAEMC,I,EAAcC,Q,EAAoBC,K,EAAwB;AAC/D,UAAI,KAAKH,KAAT,EAAgB;AACd,aAAKI,eAAL,CAAqBH,IAArB,EAA2BC,QAA3B,EAAqCC,KAArC;AACD,OAFD,MAEO;AACL,aAAKJ,KAAL,CAAWM,MAAX,CAAkBJ,IAAlB,EAAwBC,QAAxB,EAAkCC,KAAlC;AACD;AACF;;AAED;;;;;;4BAGQG,I,EAAW;AACjB,aAAO,KAAKP,KAAL,CAAWQ,OAAX,CAAmBD,IAAnB,CAAP;AACD;;AAED;;;;oCACgBL,I,EAAcC,Q,EAAoBC,K,EAAwB;AAAA;;AACxE,UAAI,KAAKH,KAAL,IAAc,KAAKA,KAAL,CAAWC,IAAX,CAAlB,EAAoC;AAClCC,iBAAS,KAAKF,KAAL,CAAWC,IAAX,CAAT;AACD,OAFD,MAEO;AACL,aAAKF,KAAL,CAAWM,MAAX,CACEJ,IADF,EAEE,mBAAW;AACT,cAAI,MAAKD,KAAT,EAAgB;AACd,kBAAKA,KAAL,CAAWC,IAAX,IAAmBO,OAAnB;AACD;AACDN,mBAASM,OAAT;AACD,SAPH,EAQEL,KARF;AAUD;AACF;;AAED;;;;8BACUM,I,EAAgC;AACxC,UAAI,OAAO,KAAKN,KAAZ,KAAsB,UAA1B,EAAsC;AACpC,eAAO,KAAKA,KAAL,CAAWM,IAAX,CAAP;AACD,OAFD,MAEO;AACL,eAAQA,KAAKN,KAAL,CAAW,KAAKA,KAAhB,CAAR;AACD;AACF;;AAED;;;;wBACwD;AACtD,aAAO,KAAKJ,KAAL,CAAWI,KAAlB;AACD;;AAED;;;;wBACoB;AAClB,aAAO,OAAO,KAAKJ,KAAL,CAAWW,KAAlB,KAA4B,QAA5B,GACH,KAAKX,KAAL,CAAWW,KADR,GAEHf,aAFJ;AAGD;;;wBAEkC;AACjC,aAAO,KAAKI,KAAL,CAAWY,QAAX,IAAuBf,gBAA9B;AACD;;;;;;kBAzEkBE,Q","file":"strategy.js","sourcesContent":["// @flow\n\ndeclare class MatchData extends Array<string> {\n  index: number;\n}\n\nexport type { MatchData }\n\nconst DEFAULT_INDEX = 2\n\nfunction DEFAULT_TEMPLATE(value) {\n  return value\n}\n\n/**\n * Properties for a strategy.\n *\n * @typedef\n */\nexport type StrategyProperties = {\n  match: RegExp | (string => MatchData | null),\n  search: Function,\n  replace: any => string[] | string | null,\n  cache?: boolean,\n  context?: Function,\n  template?: any => string,\n  index?: number,\n  id?: string,\n}\n\n/**\n * Encapsulate a single strategy.\n */\nexport default class Strategy {\n  props: StrategyProperties\n  cache: ?Object\n\n  constructor(props: StrategyProperties) {\n    this.props = props\n    this.cache = props.cache ? {} : null\n  }\n\n  /**\n   * @return {this}\n   */\n  destroy() {\n    this.cache = null\n    return this\n  }\n\n  search(term: string, callback: Function, match: MatchData): void {\n    if (this.cache) {\n      this.searchWithCache(term, callback, match)\n    } else {\n      this.props.search(term, callback, match)\n    }\n  }\n\n  /**\n   * @param {object} data - An element of array callbacked by search function.\n   */\n  replace(data: any) {\n    return this.props.replace(data)\n  }\n\n  /** @private */\n  searchWithCache(term: string, callback: Function, match: MatchData): void {\n    if (this.cache && this.cache[term]) {\n      callback(this.cache[term])\n    } else {\n      this.props.search(\n        term,\n        results => {\n          if (this.cache) {\n            this.cache[term] = results\n          }\n          callback(results)\n        },\n        match,\n      )\n    }\n  }\n\n  /** @private */\n  matchText(text: string): MatchData | null {\n    if (typeof this.match === \"function\") {\n      return this.match(text)\n    } else {\n      return (text.match(this.match): any)\n    }\n  }\n\n  /** @private */\n  get match(): $PropertyType<StrategyProperties, \"match\"> {\n    return this.props.match\n  }\n\n  /** @private */\n  get index(): number {\n    return typeof this.props.index === \"number\"\n      ? this.props.index\n      : DEFAULT_INDEX\n  }\n\n  get template(): (...any) => string {\n    return this.props.template || DEFAULT_TEMPLATE\n  }\n}\n"]}