{"version":3,"sources":["../src/dropdown_item.js"],"names":["DEFAULT_CLASS_NAME","CALLBACK_METHODS","DropdownItem","searchResult","options","active","className","activeClassName","forEach","method","bind","el","removeEventListener","onClick","onMouseover","dropdown","activeItem","_el","siblings","items","index","length","getActiveItem","deactivate","offsetToScroll","offsetTop","scrollTop","e","preventDefault","select","activate","li","document","createElement","a","innerHTML","render","appendChild","addEventListener","nextIndex","rotate"],"mappings":";;;;;;;;;AAEA;;;;;;;;AAEO,IAAMA,kDAAqB,mBAA3B;AACP,IAAMC,mBAAmB,CAAC,SAAD,EAAY,aAAZ,CAAzB;;AAEA;;;AAKA;;AAUA;;;IAGqBC,Y;AAUnB,wBAAYC,YAAZ,EAAwCC,OAAxC,EAAsE;AAAA;;AAAA;;AACpE,SAAKD,YAAL,GAAoBA,YAApB;AACA,SAAKE,MAAL,GAAc,KAAd;AACA,SAAKC,SAAL,GAAiBF,QAAQE,SAAR,IAAqBN,kBAAtC;AACA,SAAKO,eAAL,GAA0B,KAAKD,SAA/B;;AAEAL,qBAAiBO,OAAjB,CAAyB,kBAAU;AACjC,OAAC,MAAYC,MAAZ,IAAsB,MAAYA,MAAZ,EAAoBC,IAApB,OAAtB;AACF,KAFD;AAGD;;;;;;AAkBD;;;8BAGU;AACR,WAAKC,EAAL,CAAQC,mBAAR,CAA4B,WAA5B,EAAyC,KAAKC,OAA9C,EAAuD,KAAvD;AACA,WAAKF,EAAL,CAAQC,mBAAR,CAA4B,WAA5B,EAAyC,KAAKE,WAA9C,EAA2D,KAA3D;AACA,WAAKH,EAAL,CAAQC,mBAAR,CAA4B,YAA5B,EAA0C,KAAKC,OAA/C,EAAwD,KAAxD;AACA,UAAI,KAAKR,MAAT,EAAiB;AACf,aAAKU,QAAL,CAAcC,UAAd,GAA2B,IAA3B;AACD;AACD;AACA,WAAKC,GAAL,GAAW,IAAX;AACD;;AAED;;;;;;;;6BAKSF,Q,EAAoB;AAC3B,WAAKA,QAAL,GAAgBA,QAAhB;AACA,WAAKG,QAAL,GAAgBH,SAASI,KAAzB;AACA,WAAKC,KAAL,GAAa,KAAKF,QAAL,CAAcG,MAAd,GAAuB,CAApC;AACD;;AAED;;;;;;;;+BAKW;AACT,UAAI,CAAC,KAAKhB,MAAV,EAAkB;AAChB,YAAMW,cAAa,KAAKD,QAAL,CAAcO,aAAd,EAAnB;AACA,YAAIN,WAAJ,EAAgB;AACdA,sBAAWO,UAAX;AACD;AACD,aAAKR,QAAL,CAAcC,UAAd,GAA2B,IAA3B;AACA,aAAKX,MAAL,GAAc,IAAd;AACA,aAAKM,EAAL,CAAQL,SAAR,GAAoB,KAAKC,eAAzB;;AAEA,YAAMiB,iBAAiB,KAAKb,EAAL,CAAQc,SAA/B;AACA,aAAKV,QAAL,CAAcJ,EAAd,CAAiBe,SAAjB,GAA6BF,cAA7B;AACD;AACD,aAAO,IAAP;AACD;;AAED;;;;;;;;AAgCA;iCACa;AACX,UAAI,KAAKnB,MAAT,EAAiB;AACf,aAAKA,MAAL,GAAc,KAAd;AACA,aAAKM,EAAL,CAAQL,SAAR,GAAoB,KAAKA,SAAzB;AACA,aAAKS,QAAL,CAAcC,UAAd,GAA2B,IAA3B;AACD;AACD,aAAO,IAAP;AACD;;AAED;;;;4BACQW,C,EAAU;AAChBA,QAAEC,cAAF,GADgB,CACG;AACnB,WAAKb,QAAL,CAAcc,MAAd,CAAqB,IAArB;AACD;;AAED;;;;kCACc;AACZ,WAAKC,QAAL;AACD;;;wBAjHuB;AACtB,UAAI,KAAKb,GAAT,EAAc;AACZ,eAAO,KAAKA,GAAZ;AACD;AACD,UAAMc,KAAKC,SAASC,aAAT,CAAuB,IAAvB,CAAX;AACAF,SAAGzB,SAAH,GAAe,KAAKD,MAAL,GAAc,KAAKE,eAAnB,GAAqC,KAAKD,SAAzD;AACA,UAAM4B,IAAIF,SAASC,aAAT,CAAuB,GAAvB,CAAV;AACAC,QAAEC,SAAF,GAAc,KAAKhC,YAAL,CAAkBiC,MAAlB,EAAd;AACAL,SAAGM,WAAH,CAAeH,CAAf;AACA,WAAKjB,GAAL,GAAWc,EAAX;AACAA,SAAGO,gBAAH,CAAoB,WAApB,EAAiC,KAAKzB,OAAtC;AACAkB,SAAGO,gBAAH,CAAoB,WAApB,EAAiC,KAAKxB,WAAtC;AACAiB,SAAGO,gBAAH,CAAoB,YAApB,EAAkC,KAAKzB,OAAvC;AACA,aAAOkB,EAAP;AACD;;;wBAmDyB;AACxB,UAAIQ,kBAAJ;AACA,UAAI,KAAKnB,KAAL,KAAe,KAAKF,QAAL,CAAcG,MAAd,GAAuB,CAA1C,EAA6C;AAC3C,YAAI,CAAC,KAAKN,QAAL,CAAcyB,MAAnB,EAA2B;AACzB,iBAAO,IAAP;AACD;AACDD,oBAAY,CAAZ;AACD,OALD,MAKO;AACLA,oBAAY,KAAKnB,KAAL,GAAa,CAAzB;AACD;AACD,aAAO,KAAKF,QAAL,CAAcqB,SAAd,CAAP;AACD;;AAED;;;;;;wBAG0B;AACxB,UAAIA,kBAAJ;AACA,UAAI,KAAKnB,KAAL,KAAe,CAAnB,EAAsB;AACpB,YAAI,CAAC,KAAKL,QAAL,CAAcyB,MAAnB,EAA2B;AACzB,iBAAO,IAAP;AACD;AACDD,oBAAY,KAAKrB,QAAL,CAAcG,MAAd,GAAuB,CAAnC;AACD,OALD,MAKO;AACLkB,oBAAY,KAAKnB,KAAL,GAAa,CAAzB;AACD;AACD,aAAO,KAAKF,QAAL,CAAcqB,SAAd,CAAP;AACD;;;;;;kBAjHkBrC,Y","file":"dropdown_item.js","sourcesContent":["// @flow\n\nimport SearchResult from \"./search_result\"\n\nexport const DEFAULT_CLASS_NAME = \"textcomplete-item\"\nconst CALLBACK_METHODS = [\"onClick\", \"onMouseover\"]\n\n/** @typedef */\nexport type DropdownItemOptions = {\n  className?: string,\n}\n\n// Declare interface instead of importing Dropdown itself to prevent circular dependency.\ninterface Dropdown {\n  activeItem: DropdownItem | null;\n  items: DropdownItem[];\n  rotate: ?Boolean;\n  getActiveItem(): DropdownItem | null;\n  select(DropdownItem): DropdownItem;\n  el: HTMLUListElement;\n}\n\n/**\n * Encapsulate an item of dropdown.\n */\nexport default class DropdownItem {\n  searchResult: SearchResult\n  active: boolean\n  className: string\n  activeClassName: string\n  siblings: DropdownItem[]\n  dropdown: Dropdown\n  index: number\n  _el: ?HTMLLIElement\n\n  constructor(searchResult: SearchResult, options: DropdownItemOptions) {\n    this.searchResult = searchResult\n    this.active = false\n    this.className = options.className || DEFAULT_CLASS_NAME\n    this.activeClassName = `${this.className} active`\n\n    CALLBACK_METHODS.forEach(method => {\n      ;(this: any)[method] = (this: any)[method].bind(this)\n    })\n  }\n\n  get el(): HTMLLIElement {\n    if (this._el) {\n      return this._el\n    }\n    const li = document.createElement(\"li\")\n    li.className = this.active ? this.activeClassName : this.className\n    const a = document.createElement(\"a\")\n    a.innerHTML = this.searchResult.render()\n    li.appendChild(a)\n    this._el = li\n    li.addEventListener(\"mousedown\", this.onClick)\n    li.addEventListener(\"mouseover\", this.onMouseover)\n    li.addEventListener(\"touchstart\", this.onClick)\n    return li\n  }\n\n  /**\n   * Try to free resources and perform other cleanup operations.\n   */\n  destroy() {\n    this.el.removeEventListener(\"mousedown\", this.onClick, false)\n    this.el.removeEventListener(\"mouseover\", this.onMouseover, false)\n    this.el.removeEventListener(\"touchstart\", this.onClick, false)\n    if (this.active) {\n      this.dropdown.activeItem = null\n    }\n    // This element has already been removed by {@link Dropdown#clear}.\n    this._el = null\n  }\n\n  /**\n   * Callbacked when it is appended to a dropdown.\n   *\n   * @see Dropdown#append\n   */\n  appended(dropdown: Dropdown) {\n    this.dropdown = dropdown\n    this.siblings = dropdown.items\n    this.index = this.siblings.length - 1\n  }\n\n  /**\n   * Deactivate active item then activate itself.\n   *\n   * @return {this}\n   */\n  activate() {\n    if (!this.active) {\n      const activeItem = this.dropdown.getActiveItem()\n      if (activeItem) {\n        activeItem.deactivate()\n      }\n      this.dropdown.activeItem = this\n      this.active = true\n      this.el.className = this.activeClassName\n\n      const offsetToScroll = this.el.offsetTop\n      this.dropdown.el.scrollTop = offsetToScroll\n    }\n    return this\n  }\n\n  /**\n   * Get the next sibling.\n   */\n  get next(): ?DropdownItem {\n    let nextIndex\n    if (this.index === this.siblings.length - 1) {\n      if (!this.dropdown.rotate) {\n        return null\n      }\n      nextIndex = 0\n    } else {\n      nextIndex = this.index + 1\n    }\n    return this.siblings[nextIndex]\n  }\n\n  /**\n   * Get the previous sibling.\n   */\n  get prev(): ?DropdownItem {\n    let nextIndex\n    if (this.index === 0) {\n      if (!this.dropdown.rotate) {\n        return null\n      }\n      nextIndex = this.siblings.length - 1\n    } else {\n      nextIndex = this.index - 1\n    }\n    return this.siblings[nextIndex]\n  }\n\n  /** @private */\n  deactivate() {\n    if (this.active) {\n      this.active = false\n      this.el.className = this.className\n      this.dropdown.activeItem = null\n    }\n    return this\n  }\n\n  /** @private */\n  onClick(e: Event) {\n    e.preventDefault() // Prevent blur event\n    this.dropdown.select(this)\n  }\n\n  /** @private */\n  onMouseover() {\n    this.activate()\n  }\n}\n"]}