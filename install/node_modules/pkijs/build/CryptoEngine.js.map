{"version":3,"sources":["../src/CryptoEngine.js"],"names":["asn1js","makePKCS12B2Key","cryptoEngine","hashAlgorithm","keyLength","password","salt","iterationCount","u","v","result","toUpperCase","Error","passwordViewInitial","Uint8Array","passwordTransformed","ArrayBuffer","byteLength","passwordTransformedView","i","length","slice","D","dView","saltLength","sLen","Math","ceil","S","sView","saltView","passwordLength","pLen","P","pView","passwordView","sPlusPLength","I","iView","set","c","internalSequence","Promise","resolve","then","_I","dAndI","dAndIView","j","roundBuffer","digest","name","B","bView","k","iRound","sliceStart","sliceLength","chunk","Array","from","x","l","push","resultBuffer","resultView","CryptoEngine","constructor","parameters","crypto","subtle","importKey","format","keyData","algorithm","extractable","keyUsages","jwk","buffer","toLowerCase","asn1","fromBER","offset","reject","publicKeyInfo","fromSchema","ex","hash","alg","kty","ext","key_ops","algorithmId","publicKeyJSON","toJSON","Object","keys","key","privateKeyInfo","privateKeyAlgorithm","privateKeyJSON","JSON","stringify","exportKey","sequence","parse","fromJSON","toSchema","toBER","convert","inputFormat","outputFormat","encrypt","args","decrypt","sign","verify","generateKey","deriveKey","deriveBits","wrapKey","unwrapKey","getRandomValues","view","getAlgorithmByOID","oid","kdf","getOIDByAlgorithm","getAlgorithmParameters","algorithmName","operation","usages","modulusLength","publicExponent","namedCurve","public","counter","iv","info","iterations","getHashAlgorithm","signatureAlgorithm","params","schema","algorithmParams","encryptEncryptedContentInfo","contentEncryptionOID","contentEncryptionAlgorithm","pbkdf2OID","hmacOID","hmacHashAlgorithm","ivBuffer","ivView","saltBuffer","contentView","contentToEncrypt","pbkdf2Params","OctetString","valueHex","prf","Null","error","pbes2Parameters","keyDerivationFunc","encryptionScheme","contentType","encryptedContent","decryptEncryptedContentInfo","encryptedContentInfo","valueBlock","dataBuffer","idBlock","isConstructed","value","content","stampDataWithPassword","hmacAlgorithm","contentToStamp","verifyDataStampedWithPassword","signatureToVerify","contentToVerify","getSignatureParameters","privateKey","paramsObject","hashAlgorithmOID","maskGenAlgorithm","pssParameters","signWithPrivateKey","data","fillPublicKeyParameters","shaAlgorithm","algorithmObject","algorithmParamsChecked","tagClass","tagNumber","curveObject","toString","getPublicKey","publicKeyInfoSchema","publicKeyInfoBuffer","publicKeyInfoView","verifyWithPublicKey","signature","publicKey","signatureValue","hashAlgo"],"mappings":"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","file":"CryptoEngine.js","sourcesContent":["import * as asn1js from \"asn1js\";\r\nimport { getParametersValue, stringToArrayBuffer, arrayBufferToString, utilConcatBuf } from \"pvutils\";\r\nimport { createCMSECDSASignature, createECDSASignatureFromCMS } from \"./common.js\";\r\nimport PublicKeyInfo from \"./PublicKeyInfo.js\";\r\nimport PrivateKeyInfo from \"./PrivateKeyInfo.js\";\r\nimport AlgorithmIdentifier from \"./AlgorithmIdentifier.js\";\r\nimport EncryptedContentInfo from \"./EncryptedContentInfo.js\";\r\nimport RSASSAPSSParams from \"./RSASSAPSSParams.js\";\r\nimport PBKDF2Params from \"./PBKDF2Params.js\";\r\nimport PBES2Params from \"./PBES2Params.js\";\r\n//**************************************************************************************\r\n/**\r\n * Making MAC key using algorithm described in B.2 of PKCS#12 standard.\r\n */\r\nfunction makePKCS12B2Key(cryptoEngine, hashAlgorithm, keyLength, password, salt, iterationCount)\r\n{\r\n\t//region Initial variables\r\n\tlet u;\r\n\tlet v;\r\n\t\r\n\tconst result = [];\r\n\t//endregion\r\n\t\r\n\t//region Get \"u\" and \"v\" values\r\n\tswitch(hashAlgorithm.toUpperCase())\r\n\t{\r\n\t\tcase \"SHA-1\":\r\n\t\t\tu = 20; // 160\r\n\t\t\tv = 64; // 512\r\n\t\t\tbreak;\r\n\t\tcase \"SHA-256\":\r\n\t\t\tu = 32; // 256\r\n\t\t\tv = 64; // 512\r\n\t\t\tbreak;\r\n\t\tcase \"SHA-384\":\r\n\t\t\tu = 48; // 384\r\n\t\t\tv = 128; // 1024\r\n\t\t\tbreak;\r\n\t\tcase \"SHA-512\":\r\n\t\t\tu = 64; // 512\r\n\t\t\tv = 128; // 1024\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthrow new Error(\"Unsupported hashing algorithm\");\r\n\t}\r\n\t//endregion\r\n\t\r\n\t//region Main algorithm making key\r\n\t//region Transform password to UTF-8 like string\r\n\tconst passwordViewInitial = new Uint8Array(password);\r\n\t\r\n\tconst passwordTransformed = new ArrayBuffer((password.byteLength * 2) + 2);\r\n\tconst passwordTransformedView = new Uint8Array(passwordTransformed);\r\n\t\r\n\tfor(let i = 0; i < passwordViewInitial.length; i++)\r\n\t{\r\n\t\tpasswordTransformedView[i * 2] = 0x00;\r\n\t\tpasswordTransformedView[i * 2 + 1] = passwordViewInitial[i];\r\n\t}\r\n\t\r\n\tpasswordTransformedView[passwordTransformedView.length - 2] = 0x00;\r\n\tpasswordTransformedView[passwordTransformedView.length - 1] = 0x00;\r\n\t\r\n\tpassword = passwordTransformed.slice(0);\r\n\t//endregion\r\n\t\r\n\t//region Construct a string D (the \"diversifier\") by concatenating v/8 copies of ID\r\n\tconst D = new ArrayBuffer(v);\r\n\tconst dView = new Uint8Array(D);\r\n\t\r\n\tfor(let i = 0; i < D.byteLength; i++)\r\n\t\tdView[i] = 3; // The ID value equal to \"3\" for MACing (see B.3 of standard)\r\n\t//endregion\r\n\t\r\n\t//region Concatenate copies of the salt together to create a string S of length v * ceil(s / v) bytes (the final copy of the salt may be trunacted to create S)\r\n\tconst saltLength = salt.byteLength;\r\n\t\r\n\tconst sLen = v * Math.ceil(saltLength / v);\r\n\tconst S = new ArrayBuffer(sLen);\r\n\tconst sView = new Uint8Array(S);\r\n\t\r\n\tconst saltView = new Uint8Array(salt);\r\n\t\r\n\tfor(let i = 0; i < sLen; i++)\r\n\t\tsView[i] = saltView[i % saltLength];\r\n\t//endregion\r\n\t\r\n\t//region Concatenate copies of the password together to create a string P of length v * ceil(p / v) bytes (the final copy of the password may be truncated to create P)\r\n\tconst passwordLength = password.byteLength;\r\n\t\r\n\tconst pLen = v * Math.ceil(passwordLength / v);\r\n\tconst P = new ArrayBuffer(pLen);\r\n\tconst pView = new Uint8Array(P);\r\n\t\r\n\tconst passwordView = new Uint8Array(password);\r\n\t\r\n\tfor(let i = 0; i < pLen; i++)\r\n\t\tpView[i] = passwordView[i % passwordLength];\r\n\t//endregion\r\n\t\r\n\t//region Set I=S||P to be the concatenation of S and P\r\n\tconst sPlusPLength = S.byteLength + P.byteLength;\r\n\t\r\n\tlet I = new ArrayBuffer(sPlusPLength);\r\n\tlet iView = new Uint8Array(I);\r\n\t\r\n\tiView.set(sView);\r\n\tiView.set(pView, sView.length);\r\n\t//endregion\r\n\t\r\n\t//region Set c=ceil(n / u)\r\n\tconst c = Math.ceil((keyLength >> 3) / u);\r\n\t//endregion\r\n\t\r\n\t//region Initial variables\r\n\tlet internalSequence = Promise.resolve(I);\r\n\t//endregion\r\n\t\r\n\t//region For i=1, 2, ..., c, do the following:\r\n\tfor(let i = 0; i <= c; i++)\r\n\t{\r\n\t\tinternalSequence = internalSequence.then(_I =>\r\n\t\t{\r\n\t\t\t//region Create contecanetion of D and I\r\n\t\t\tconst dAndI = new ArrayBuffer(D.byteLength + _I.byteLength);\r\n\t\t\tconst dAndIView = new Uint8Array(dAndI);\r\n\t\t\t\r\n\t\t\tdAndIView.set(dView);\r\n\t\t\tdAndIView.set(iView, dView.length);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\treturn dAndI;\r\n\t\t});\r\n\t\t\r\n\t\t//region Make \"iterationCount\" rounds of hashing\r\n\t\tfor(let j = 0; j < iterationCount; j++)\r\n\t\t\tinternalSequence = internalSequence.then(roundBuffer => cryptoEngine.digest({ name: hashAlgorithm }, new Uint8Array(roundBuffer)));\r\n\t\t//endregion\r\n\t\t\r\n\t\tinternalSequence = internalSequence.then(roundBuffer =>\r\n\t\t{\r\n\t\t\t//region Concatenate copies of Ai to create a string B of length v bits (the final copy of Ai may be truncated to create B)\r\n\t\t\tconst B = new ArrayBuffer(v);\r\n\t\t\tconst bView = new Uint8Array(B);\r\n\t\t\t\r\n\t\t\tfor(let j = 0; j < B.byteLength; j++)\r\n\t\t\t\tbView[j] = roundBuffer[j % roundBuffer.length];\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Make new I value\r\n\t\t\tconst k = Math.ceil(saltLength / v) + Math.ceil(passwordLength / v);\r\n\t\t\tconst iRound = [];\r\n\t\t\t\r\n\t\t\tlet sliceStart = 0;\r\n\t\t\tlet sliceLength = v;\r\n\t\t\t\r\n\t\t\tfor(let j = 0; j < k; j++)\r\n\t\t\t{\r\n\t\t\t\tconst chunk = Array.from(new Uint8Array(I.slice(sliceStart, sliceStart + sliceLength)));\r\n\t\t\t\tsliceStart += v;\r\n\t\t\t\tif((sliceStart + v) > I.byteLength)\r\n\t\t\t\t\tsliceLength = I.byteLength - sliceStart;\r\n\t\t\t\t\r\n\t\t\t\tlet x = 0x1ff;\r\n\t\t\t\t\r\n\t\t\t\tfor(let l = (B.byteLength - 1); l >= 0; l--)\r\n\t\t\t\t{\r\n\t\t\t\t\tx >>= 8;\r\n\t\t\t\t\tx += bView[l] + chunk[l];\r\n\t\t\t\t\tchunk[l] = (x & 0xff);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tiRound.push(...chunk);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tI = new ArrayBuffer(iRound.length);\r\n\t\t\tiView = new Uint8Array(I);\r\n\t\t\t\r\n\t\t\tiView.set(iRound);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\tresult.push(...(new Uint8Array(roundBuffer)));\r\n\t\t\t\r\n\t\t\treturn I;\r\n\t\t});\r\n\t}\r\n\t//endregion\r\n\t\r\n\t//region Initialize final key\r\n\tinternalSequence = internalSequence.then(() =>\r\n\t{\r\n\t\tconst resultBuffer = new ArrayBuffer(keyLength >> 3);\r\n\t\tconst resultView = new Uint8Array(resultBuffer);\r\n\t\t\r\n\t\tresultView.set((new Uint8Array(result)).slice(0, keyLength >> 3));\r\n\t\t\r\n\t\treturn resultBuffer;\r\n\t});\r\n\t//endregion\r\n\t//endregion\r\n\t\r\n\treturn internalSequence;\r\n}\r\n//**************************************************************************************\r\n/**\r\n * Default cryptographic engine for Web Cryptography API\r\n */\r\nexport default class CryptoEngine\r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for CryptoEngine class\r\n\t * @param {Object} [parameters={}]\r\n\t * @property {Object} [schema] asn1js parsed value\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t//region Internal properties of the object\r\n\t\t/**\r\n\t\t * @type {Object}\r\n\t\t * @description Usually here we are expecting \"window.crypto\" or an equivalent from custom \"crypto engine\"\r\n\t\t */\r\n\t\tthis.crypto = getParametersValue(parameters, \"crypto\", {});\r\n\t\t/**\r\n\t\t * @type {Object}\r\n\t\t * @description Usually here we are expecting \"window.crypto.subtle\" or an equivalent from custom \"crypto engine\"\r\n\t\t */\r\n\t\tthis.subtle = getParametersValue(parameters, \"subtle\", {});\r\n\t\t/**\r\n\t\t * @type {string}\r\n\t\t * @description Name of the \"crypto engine\"\r\n\t\t */\r\n\t\tthis.name = getParametersValue(parameters, \"name\", \"\");\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Import WebCrypto keys from different formats\r\n\t * @param {string} format\r\n\t * @param {ArrayBuffer|Uint8Array} keyData\r\n\t * @param {Object} algorithm\r\n\t * @param {boolean} extractable\r\n\t * @param {Array} keyUsages\r\n\t * @returns {Promise}\r\n\t */\r\n\timportKey(format, keyData, algorithm, extractable, keyUsages)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet jwk = {};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"keyData\" type if needed\r\n\t\tif(keyData instanceof Uint8Array)\r\n\t\t\tkeyData = keyData.buffer;\r\n\t\t//endregion\r\n\t\t\r\n\t\tswitch(format.toLowerCase())\r\n\t\t{\r\n\t\t\tcase \"raw\":\r\n\t\t\t\treturn this.subtle.importKey(\"raw\", keyData, algorithm, extractable, keyUsages);\r\n\t\t\tcase \"spki\":\r\n\t\t\t\t{\r\n\t\t\t\t\tconst asn1 = asn1js.fromBER(keyData);\r\n\t\t\t\t\tif(asn1.offset === (-1))\r\n\t\t\t\t\t\treturn Promise.reject(\"Incorrect keyData\");\r\n\r\n\t\t\t\t\tconst publicKeyInfo = new PublicKeyInfo();\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpublicKeyInfo.fromSchema(asn1.result);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(ex)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn Promise.reject(\"Incorrect keyData\");\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t// noinspection FallThroughInSwitchStatementJS\r\n\t\t\t\t\tswitch(algorithm.name.toUpperCase())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase \"RSA-PSS\":\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t//region Get information about used hash function\r\n\t\t\t\t\t\t\t\tswitch(algorithm.hash.name.toUpperCase())\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tcase \"SHA-1\":\r\n\t\t\t\t\t\t\t\t\t\tjwk.alg = \"PS1\";\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase \"SHA-256\":\r\n\t\t\t\t\t\t\t\t\t\tjwk.alg = \"PS256\";\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase \"SHA-384\":\r\n\t\t\t\t\t\t\t\t\t\tjwk.alg = \"PS384\";\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase \"SHA-512\":\r\n\t\t\t\t\t\t\t\t\t\tjwk.alg = \"PS512\";\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\treturn Promise.reject(`Incorrect hash algorithm: ${algorithm.hash.name.toUpperCase()}`);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t//endregion\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// break omitted\r\n\t\t\t\t\t\tcase \"RSASSA-PKCS1-V1_5\":\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tkeyUsages = [\"verify\"]; // Override existing keyUsages value since the key is a public key\r\n\r\n\t\t\t\t\t\t\t\tjwk.kty = \"RSA\";\r\n\t\t\t\t\t\t\t\tjwk.ext = extractable;\r\n\t\t\t\t\t\t\t\tjwk.key_ops = keyUsages;\r\n\r\n\t\t\t\t\t\t\t\tif(publicKeyInfo.algorithm.algorithmId !== \"1.2.840.113549.1.1.1\")\r\n\t\t\t\t\t\t\t\t\treturn Promise.reject(`Incorrect public key algorithm: ${publicKeyInfo.algorithm.algorithmId}`);\r\n\r\n\t\t\t\t\t\t\t\t//region Get information about used hash function\r\n\t\t\t\t\t\t\t\tif((\"alg\" in jwk) === false)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tswitch(algorithm.hash.name.toUpperCase())\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-1\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RS1\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-256\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RS256\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-384\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RS384\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-512\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RS512\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\t\treturn Promise.reject(`Incorrect public key algorithm: ${publicKeyInfo.algorithm.algorithmId}`);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t//endregion\r\n\r\n\t\t\t\t\t\t\t\t//region Create RSA Public Key elements\r\n\t\t\t\t\t\t\t\tconst publicKeyJSON = publicKeyInfo.toJSON();\r\n\r\n\t\t\t\t\t\t\t\tfor(const key of Object.keys(publicKeyJSON))\r\n\t\t\t\t\t\t\t\t\tjwk[key] = publicKeyJSON[key];\r\n\t\t\t\t\t\t\t\t//endregion\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"ECDSA\":\r\n\t\t\t\t\t\t\tkeyUsages = [\"verify\"]; // Override existing keyUsages value since the key is a public key\r\n\t\t\t\t\t\t\t// break omitted\r\n\t\t\t\t\t\tcase \"ECDH\":\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t//region Initial variables\r\n\t\t\t\t\t\t\t\tjwk = {\r\n\t\t\t\t\t\t\t\t\tkty: \"EC\",\r\n\t\t\t\t\t\t\t\t\text: extractable,\r\n\t\t\t\t\t\t\t\t\tkey_ops: keyUsages\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t//endregion\r\n\r\n\t\t\t\t\t\t\t\t//region Get information about algorithm\r\n\t\t\t\t\t\t\t\tif(publicKeyInfo.algorithm.algorithmId !== \"1.2.840.10045.2.1\")\r\n\t\t\t\t\t\t\t\t\treturn Promise.reject(`Incorrect public key algorithm: ${publicKeyInfo.algorithm.algorithmId}`);\r\n\t\t\t\t\t\t\t\t//endregion\r\n\r\n\t\t\t\t\t\t\t\t//region Create ECDSA Public Key elements\r\n\t\t\t\t\t\t\t\tconst publicKeyJSON = publicKeyInfo.toJSON();\r\n\r\n\t\t\t\t\t\t\t\tfor(const key of Object.keys(publicKeyJSON))\r\n\t\t\t\t\t\t\t\t\tjwk[key] = publicKeyJSON[key];\r\n\t\t\t\t\t\t\t\t//endregion\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"RSA-OAEP\":\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tjwk.kty = \"RSA\";\r\n\t\t\t\t\t\t\t\tjwk.ext = extractable;\r\n\t\t\t\t\t\t\t\tjwk.key_ops = keyUsages;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif(this.name.toLowerCase() === \"safari\")\r\n\t\t\t\t\t\t\t\t\tjwk.alg = \"RSA-OAEP\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tswitch(algorithm.hash.name.toUpperCase())\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-1\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RSA-OAEP\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-256\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RSA-OAEP-256\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-384\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RSA-OAEP-384\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-512\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RSA-OAEP-512\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\t\treturn Promise.reject(`Incorrect public key algorithm: ${publicKeyInfo.algorithm.algorithmId}`);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t//region Create ECDSA Public Key elements\r\n\t\t\t\t\t\t\t\tconst publicKeyJSON = publicKeyInfo.toJSON();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfor(const key of Object.keys(publicKeyJSON))\r\n\t\t\t\t\t\t\t\t\tjwk[key] = publicKeyJSON[key];\r\n\t\t\t\t\t\t\t\t//endregion\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\treturn Promise.reject(`Incorrect algorithm name: ${algorithm.name.toUpperCase()}`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"pkcs8\":\r\n\t\t\t\t{\r\n\t\t\t\t\tconst privateKeyInfo = new PrivateKeyInfo();\r\n\r\n\t\t\t\t\t//region Parse \"PrivateKeyInfo\" object\r\n\t\t\t\t\tconst asn1 = asn1js.fromBER(keyData);\r\n\t\t\t\t\tif(asn1.offset === (-1))\r\n\t\t\t\t\t\treturn Promise.reject(\"Incorrect keyData\");\r\n\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tprivateKeyInfo.fromSchema(asn1.result);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(ex)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn Promise.reject(\"Incorrect keyData\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif((\"parsedKey\" in privateKeyInfo) === false)\r\n\t\t\t\t\t\treturn Promise.reject(\"Incorrect keyData\");\r\n\t\t\t\t\t//endregion\r\n\r\n\t\t\t\t\t// noinspection FallThroughInSwitchStatementJS\r\n\t\t\t\t\t// noinspection FallThroughInSwitchStatementJS\r\n\t\t\t\t\tswitch(algorithm.name.toUpperCase())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase \"RSA-PSS\":\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t//region Get information about used hash function\r\n\t\t\t\t\t\t\t\tswitch(algorithm.hash.name.toUpperCase())\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tcase \"SHA-1\":\r\n\t\t\t\t\t\t\t\t\t\tjwk.alg = \"PS1\";\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase \"SHA-256\":\r\n\t\t\t\t\t\t\t\t\t\tjwk.alg = \"PS256\";\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase \"SHA-384\":\r\n\t\t\t\t\t\t\t\t\t\tjwk.alg = \"PS384\";\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase \"SHA-512\":\r\n\t\t\t\t\t\t\t\t\t\tjwk.alg = \"PS512\";\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\treturn Promise.reject(`Incorrect hash algorithm: ${algorithm.hash.name.toUpperCase()}`);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t//endregion\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// break omitted\r\n\t\t\t\t\t\tcase \"RSASSA-PKCS1-V1_5\":\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tkeyUsages = [\"sign\"]; // Override existing keyUsages value since the key is a private key\r\n\r\n\t\t\t\t\t\t\t\tjwk.kty = \"RSA\";\r\n\t\t\t\t\t\t\t\tjwk.ext = extractable;\r\n\t\t\t\t\t\t\t\tjwk.key_ops = keyUsages;\r\n\r\n\t\t\t\t\t\t\t\t//region Get information about used hash function\r\n\t\t\t\t\t\t\t\tif(privateKeyInfo.privateKeyAlgorithm.algorithmId !== \"1.2.840.113549.1.1.1\")\r\n\t\t\t\t\t\t\t\t\treturn Promise.reject(`Incorrect private key algorithm: ${privateKeyInfo.privateKeyAlgorithm.algorithmId}`);\r\n\t\t\t\t\t\t\t\t//endregion\r\n\r\n\t\t\t\t\t\t\t\t//region Get information about used hash function\r\n\t\t\t\t\t\t\t\tif((\"alg\" in jwk) === false)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tswitch(algorithm.hash.name.toUpperCase())\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-1\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RS1\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-256\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RS256\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-384\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RS384\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-512\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RS512\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\t\treturn Promise.reject(`Incorrect hash algorithm: ${algorithm.hash.name.toUpperCase()}`);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t//endregion\r\n\r\n\t\t\t\t\t\t\t\t//region Create RSA Private Key elements\r\n\t\t\t\t\t\t\t\tconst privateKeyJSON = privateKeyInfo.toJSON();\r\n\r\n\t\t\t\t\t\t\t\tfor(const key of Object.keys(privateKeyJSON))\r\n\t\t\t\t\t\t\t\t\tjwk[key] = privateKeyJSON[key];\r\n\t\t\t\t\t\t\t\t//endregion\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"ECDSA\":\r\n\t\t\t\t\t\t\tkeyUsages = [\"sign\"]; // Override existing keyUsages value since the key is a private key\r\n\t\t\t\t\t\t\t// break omitted\r\n\t\t\t\t\t\tcase \"ECDH\":\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t//region Initial variables\r\n\t\t\t\t\t\t\t\tjwk = {\r\n\t\t\t\t\t\t\t\t\tkty: \"EC\",\r\n\t\t\t\t\t\t\t\t\text: extractable,\r\n\t\t\t\t\t\t\t\t\tkey_ops: keyUsages\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t//endregion\r\n\r\n\t\t\t\t\t\t\t\t//region Get information about used hash function\r\n\t\t\t\t\t\t\t\tif(privateKeyInfo.privateKeyAlgorithm.algorithmId !== \"1.2.840.10045.2.1\")\r\n\t\t\t\t\t\t\t\t\treturn Promise.reject(`Incorrect algorithm: ${privateKeyInfo.privateKeyAlgorithm.algorithmId}`);\r\n\t\t\t\t\t\t\t\t//endregion\r\n\r\n\t\t\t\t\t\t\t\t//region Create ECDSA Private Key elements\r\n\t\t\t\t\t\t\t\tconst privateKeyJSON = privateKeyInfo.toJSON();\r\n\r\n\t\t\t\t\t\t\t\tfor(const key of Object.keys(privateKeyJSON))\r\n\t\t\t\t\t\t\t\t\tjwk[key] = privateKeyJSON[key];\r\n\t\t\t\t\t\t\t\t//endregion\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"RSA-OAEP\":\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tjwk.kty = \"RSA\";\r\n\t\t\t\t\t\t\t\tjwk.ext = extractable;\r\n\t\t\t\t\t\t\t\tjwk.key_ops = keyUsages;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t//region Get information about used hash function\r\n\t\t\t\t\t\t\t\tif(this.name.toLowerCase() === \"safari\")\r\n\t\t\t\t\t\t\t\t\tjwk.alg = \"RSA-OAEP\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tswitch(algorithm.hash.name.toUpperCase())\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-1\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RSA-OAEP\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-256\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RSA-OAEP-256\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-384\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RSA-OAEP-384\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase \"SHA-512\":\r\n\t\t\t\t\t\t\t\t\t\t\tjwk.alg = \"RSA-OAEP-512\";\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\t\treturn Promise.reject(`Incorrect hash algorithm: ${algorithm.hash.name.toUpperCase()}`);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t//endregion\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t//region Create RSA Private Key elements\r\n\t\t\t\t\t\t\t\tconst privateKeyJSON = privateKeyInfo.toJSON();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfor(const key of Object.keys(privateKeyJSON))\r\n\t\t\t\t\t\t\t\t\tjwk[key] = privateKeyJSON[key];\r\n\t\t\t\t\t\t\t\t//endregion\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\treturn Promise.reject(`Incorrect algorithm name: ${algorithm.name.toUpperCase()}`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"jwk\":\r\n\t\t\t\tjwk = keyData;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\treturn Promise.reject(`Incorrect format: ${format}`);\r\n\t\t}\r\n\t\t\r\n\t\t//region Special case for Safari browser (since its acting not as WebCrypto standard describes)\r\n\t\tif(this.name.toLowerCase() === \"safari\")\r\n\t\t{\r\n\t\t\t// Try to use both ways - import using ArrayBuffer and pure JWK (for Safari Technology Preview)\r\n\t\t\treturn Promise.resolve().then(() => this.subtle.importKey(\"jwk\", stringToArrayBuffer(JSON.stringify(jwk)), algorithm, extractable, keyUsages))\r\n\t\t\t\t.then(result => result, () => this.subtle.importKey(\"jwk\", jwk, algorithm, extractable, keyUsages));\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn this.subtle.importKey(\"jwk\", jwk, algorithm, extractable, keyUsages);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Export WebCrypto keys to different formats\r\n\t * @param {string} format\r\n\t * @param {Object} key\r\n\t * @returns {Promise}\r\n\t */\r\n\texportKey(format, key)\r\n\t{\r\n\t\tlet sequence = this.subtle.exportKey(\"jwk\", key);\r\n\t\t\r\n\t\t//region Currently Safari returns ArrayBuffer as JWK thus we need an additional transformation\r\n\t\tif(this.name.toLowerCase() === \"safari\")\r\n\t\t{\r\n\t\t\tsequence = sequence.then(result =>\r\n\t\t\t{\r\n\t\t\t\t// Some additional checks for Safari Technology Preview\r\n\t\t\t\tif(result instanceof ArrayBuffer)\r\n\t\t\t\t\treturn JSON.parse(arrayBufferToString(result));\r\n\t\t\t\t\r\n\t\t\t\treturn result;\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\tswitch(format.toLowerCase())\r\n\t\t{\r\n\t\t\tcase \"raw\":\r\n\t\t\t\treturn this.subtle.exportKey(\"raw\", key);\r\n\t\t\tcase \"spki\":\r\n\t\t\t\tsequence = sequence.then(result =>\r\n\t\t\t\t{\r\n\t\t\t\t\tconst publicKeyInfo = new PublicKeyInfo();\r\n\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpublicKeyInfo.fromJSON(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(ex)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn Promise.reject(\"Incorrect key data\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn publicKeyInfo.toSchema().toBER(false);\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"pkcs8\":\r\n\t\t\t\tsequence = sequence.then(result =>\r\n\t\t\t\t{\r\n\t\t\t\t\tconst privateKeyInfo = new PrivateKeyInfo();\r\n\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tprivateKeyInfo.fromJSON(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(ex)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn Promise.reject(\"Incorrect key data\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn privateKeyInfo.toSchema().toBER(false);\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"jwk\":\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\treturn Promise.reject(`Incorrect format: ${format}`);\r\n\t\t}\r\n\r\n\t\treturn sequence;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert WebCrypto keys between different export formats\r\n\t * @param {string} inputFormat\r\n\t * @param {string} outputFormat\r\n\t * @param {ArrayBuffer|Object} keyData\r\n\t * @param {Object} algorithm\r\n\t * @param {boolean} extractable\r\n\t * @param {Array} keyUsages\r\n\t * @returns {Promise}\r\n\t */\r\n\tconvert(inputFormat, outputFormat, keyData, algorithm, extractable, keyUsages)\r\n\t{\r\n\t\tswitch(inputFormat.toLowerCase())\r\n\t\t{\r\n\t\t\tcase \"raw\":\r\n\t\t\t\tswitch(outputFormat.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"raw\":\r\n\t\t\t\t\t\treturn Promise.resolve(keyData);\r\n\t\t\t\t\tcase \"spki\":\r\n\t\t\t\t\t\treturn Promise.resolve()\r\n\t\t\t\t\t\t\t.then(() => this.importKey(\"raw\", keyData, algorithm, extractable, keyUsages))\r\n\t\t\t\t\t\t\t.then(result => this.exportKey(\"spki\", result));\r\n\t\t\t\t\tcase \"pkcs8\":\r\n\t\t\t\t\t\treturn Promise.resolve()\r\n\t\t\t\t\t\t\t.then(() => this.importKey(\"raw\", keyData, algorithm, extractable, keyUsages))\r\n\t\t\t\t\t\t\t.then(result => this.exportKey(\"pkcs8\", result));\r\n\t\t\t\t\tcase \"jwk\":\r\n\t\t\t\t\t\treturn Promise.resolve()\r\n\t\t\t\t\t\t\t.then(() => this.importKey(\"raw\", keyData, algorithm, extractable, keyUsages))\r\n\t\t\t\t\t\t\t.then(result => this.exportKey(\"jwk\", result));\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn Promise.reject(`Incorrect outputFormat: ${outputFormat}`);\r\n\t\t\t\t}\r\n\t\t\tcase \"spki\":\r\n\t\t\t\tswitch(outputFormat.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"raw\":\r\n\t\t\t\t\t\treturn Promise.resolve()\r\n\t\t\t\t\t\t\t.then(() => this.importKey(\"spki\", keyData, algorithm, extractable, keyUsages))\r\n\t\t\t\t\t\t\t.then(result => this.exportKey(\"raw\", result));\r\n\t\t\t\t\tcase \"spki\":\r\n\t\t\t\t\t\treturn Promise.resolve(keyData);\r\n\t\t\t\t\tcase \"pkcs8\":\r\n\t\t\t\t\t\treturn Promise.reject(\"Impossible to convert between SPKI/PKCS8\");\r\n\t\t\t\t\tcase \"jwk\":\r\n\t\t\t\t\t\treturn Promise.resolve()\r\n\t\t\t\t\t\t\t.then(() => this.importKey(\"spki\", keyData, algorithm, extractable, keyUsages))\r\n\t\t\t\t\t\t\t.then(result => this.exportKey(\"jwk\", result));\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn Promise.reject(`Incorrect outputFormat: ${outputFormat}`);\r\n\t\t\t\t}\r\n\t\t\tcase \"pkcs8\":\r\n\t\t\t\tswitch(outputFormat.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"raw\":\r\n\t\t\t\t\t\treturn Promise.resolve()\r\n\t\t\t\t\t\t\t.then(() => this.importKey(\"pkcs8\", keyData, algorithm, extractable, keyUsages))\r\n\t\t\t\t\t\t\t.then(result => this.exportKey(\"raw\", result));\r\n\t\t\t\t\tcase \"spki\":\r\n\t\t\t\t\t\treturn Promise.reject(\"Impossible to convert between SPKI/PKCS8\");\r\n\t\t\t\t\tcase \"pkcs8\":\r\n\t\t\t\t\t\treturn Promise.resolve(keyData);\r\n\t\t\t\t\tcase \"jwk\":\r\n\t\t\t\t\t\treturn Promise.resolve()\r\n\t\t\t\t\t\t\t.then(() => this.importKey(\"pkcs8\", keyData, algorithm, extractable, keyUsages))\r\n\t\t\t\t\t\t\t.then(result => this.exportKey(\"jwk\", result));\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn Promise.reject(`Incorrect outputFormat: ${outputFormat}`);\r\n\t\t\t\t}\r\n\t\t\tcase \"jwk\":\r\n\t\t\t\tswitch(outputFormat.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"raw\":\r\n\t\t\t\t\t\treturn Promise.resolve()\r\n\t\t\t\t\t\t\t.then(() => this.importKey(\"jwk\", keyData, algorithm, extractable, keyUsages))\r\n\t\t\t\t\t\t\t.then(result => this.exportKey(\"raw\", result));\r\n\t\t\t\t\tcase \"spki\":\r\n\t\t\t\t\t\treturn Promise.resolve()\r\n\t\t\t\t\t\t\t.then(() => this.importKey(\"jwk\", keyData, algorithm, extractable, keyUsages))\r\n\t\t\t\t\t\t\t.then(result => this.exportKey(\"spki\", result));\r\n\t\t\t\t\tcase \"pkcs8\":\r\n\t\t\t\t\t\treturn Promise.resolve()\r\n\t\t\t\t\t\t\t.then(() => this.importKey(\"jwk\", keyData, algorithm, extractable, keyUsages))\r\n\t\t\t\t\t\t\t.then(result => this.exportKey(\"pkcs8\", result));\r\n\t\t\t\t\tcase \"jwk\":\r\n\t\t\t\t\t\treturn Promise.resolve(keyData);\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn Promise.reject(`Incorrect outputFormat: ${outputFormat}`);\r\n\t\t\t\t}\r\n\t\t\tdefault:\r\n\t\t\t\treturn Promise.reject(`Incorrect inputFormat: ${inputFormat}`);\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Wrapper for standard function \"encrypt\"\r\n\t * @param args\r\n\t * @returns {Promise}\r\n\t */\r\n\tencrypt(...args)\r\n\t{\r\n\t\treturn this.subtle.encrypt(...args);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Wrapper for standard function \"decrypt\"\r\n\t * @param args\r\n\t * @returns {Promise}\r\n\t */\r\n\tdecrypt(...args)\r\n\t{\r\n\t\treturn this.subtle.decrypt(...args);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Wrapper for standard function \"sign\"\r\n\t * @param args\r\n\t * @returns {Promise}\r\n\t */\r\n\tsign(...args)\r\n\t{\r\n\t\treturn this.subtle.sign(...args);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Wrapper for standard function \"verify\"\r\n\t * @param args\r\n\t * @returns {Promise}\r\n\t */\r\n\tverify(...args)\r\n\t{\r\n\t\treturn this.subtle.verify(...args);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Wrapper for standard function \"digest\"\r\n\t * @param args\r\n\t * @returns {Promise}\r\n\t */\r\n\tdigest(...args)\r\n\t{\r\n\t\treturn this.subtle.digest(...args);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Wrapper for standard function \"generateKey\"\r\n\t * @param args\r\n\t * @returns {Promise}\r\n\t */\r\n\tgenerateKey(...args)\r\n\t{\r\n\t\treturn this.subtle.generateKey(...args);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Wrapper for standard function \"deriveKey\"\r\n\t * @param args\r\n\t * @returns {Promise}\r\n\t */\r\n\tderiveKey(...args)\r\n\t{\r\n\t\treturn this.subtle.deriveKey(...args);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Wrapper for standard function \"deriveBits\"\r\n\t * @param args\r\n\t * @returns {Promise}\r\n\t */\r\n\tderiveBits(...args)\r\n\t{\r\n\t\treturn this.subtle.deriveBits(...args);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Wrapper for standard function \"wrapKey\"\r\n\t * @param args\r\n\t * @returns {Promise}\r\n\t */\r\n\twrapKey(...args)\r\n\t{\r\n\t\treturn this.subtle.wrapKey(...args);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Wrapper for standard function \"unwrapKey\"\r\n\t * @param args\r\n\t * @returns {Promise}\r\n\t */\r\n\tunwrapKey(...args)\r\n\t{\r\n\t\treturn this.subtle.unwrapKey(...args);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize input Uint8Array by random values (with help from current \"crypto engine\")\r\n\t * @param {!Uint8Array} view\r\n\t * @returns {*}\r\n\t */\r\n\tgetRandomValues(view)\r\n\t{\r\n\t\tif((\"getRandomValues\" in this.crypto) === false)\r\n\t\t\tthrow new Error(\"No support for getRandomValues\");\r\n\t\t\r\n\t\treturn this.crypto.getRandomValues(view);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Get WebCrypto algorithm by wel-known OID\r\n\t * @param {string} oid well-known OID to search for\r\n\t * @returns {Object}\r\n\t */\r\n\tgetAlgorithmByOID(oid)\r\n\t{\r\n\t\tswitch(oid)\r\n\t\t{\r\n\t\t\tcase \"1.2.840.113549.1.1.1\":\r\n\t\t\tcase \"1.2.840.113549.1.1.5\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"RSASSA-PKCS1-v1_5\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-1\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.113549.1.1.11\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"RSASSA-PKCS1-v1_5\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-256\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.113549.1.1.12\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"RSASSA-PKCS1-v1_5\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-384\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.113549.1.1.13\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"RSASSA-PKCS1-v1_5\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-512\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.113549.1.1.10\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"RSA-PSS\"\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.113549.1.1.7\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"RSA-OAEP\"\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.10045.2.1\":\r\n\t\t\tcase \"1.2.840.10045.4.1\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"ECDSA\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-1\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.10045.4.3.2\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"ECDSA\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-256\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.10045.4.3.3\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"ECDSA\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-384\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.10045.4.3.4\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"ECDSA\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-512\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.3.133.16.840.63.0.2\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"ECDH\",\r\n\t\t\t\t\tkdf: \"SHA-1\"\r\n\t\t\t\t};\r\n\t\t\tcase \"1.3.132.1.11.1\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"ECDH\",\r\n\t\t\t\t\tkdf: \"SHA-256\"\r\n\t\t\t\t};\r\n\t\t\tcase \"1.3.132.1.11.2\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"ECDH\",\r\n\t\t\t\t\tkdf: \"SHA-384\"\r\n\t\t\t\t};\r\n\t\t\tcase \"1.3.132.1.11.3\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"ECDH\",\r\n\t\t\t\t\tkdf: \"SHA-512\"\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.2\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-CBC\",\r\n\t\t\t\t\tlength: 128\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.22\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-CBC\",\r\n\t\t\t\t\tlength: 192\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.42\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-CBC\",\r\n\t\t\t\t\tlength: 256\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.6\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-GCM\",\r\n\t\t\t\t\tlength: 128\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.26\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-GCM\",\r\n\t\t\t\t\tlength: 192\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.46\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-GCM\",\r\n\t\t\t\t\tlength: 256\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.4\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-CFB\",\r\n\t\t\t\t\tlength: 128\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.24\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-CFB\",\r\n\t\t\t\t\tlength: 192\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.44\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-CFB\",\r\n\t\t\t\t\tlength: 256\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.5\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-KW\",\r\n\t\t\t\t\tlength: 128\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.25\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-KW\",\r\n\t\t\t\t\tlength: 192\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.1.45\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"AES-KW\",\r\n\t\t\t\t\tlength: 256\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.113549.2.7\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"HMAC\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-1\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.113549.2.9\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"HMAC\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-256\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.113549.2.10\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"HMAC\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-384\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.113549.2.11\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"HMAC\",\r\n\t\t\t\t\thash: {\r\n\t\t\t\t\t\tname: \"SHA-512\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.113549.1.9.16.3.5\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"DH\"\r\n\t\t\t\t};\r\n\t\t\tcase \"1.3.14.3.2.26\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"SHA-1\"\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.2.1\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"SHA-256\"\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.2.2\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"SHA-384\"\r\n\t\t\t\t};\r\n\t\t\tcase \"2.16.840.1.101.3.4.2.3\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"SHA-512\"\r\n\t\t\t\t};\r\n\t\t\tcase \"1.2.840.113549.1.5.12\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"PBKDF2\"\r\n\t\t\t\t};\r\n\t\t\t//region Special case - OIDs for ECC curves\r\n\t\t\tcase \"1.2.840.10045.3.1.7\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"P-256\"\r\n\t\t\t\t};\r\n\t\t\tcase \"1.3.132.0.34\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"P-384\"\r\n\t\t\t\t};\r\n\t\t\tcase \"1.3.132.0.35\":\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: \"P-521\"\r\n\t\t\t\t};\r\n\t\t\t//endregion\r\n\t\t\tdefault:\r\n\t\t}\r\n\t\t\r\n\t\treturn {};\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Get OID for each specific algorithm\r\n\t * @param {Object} algorithm\r\n\t * @returns {string}\r\n\t */\r\n\tgetOIDByAlgorithm(algorithm)\r\n\t{\r\n\t\tlet result = \"\";\r\n\t\t\r\n\t\tswitch(algorithm.name.toUpperCase())\r\n\t\t{\r\n\t\t\tcase \"RSASSA-PKCS1-V1_5\":\r\n\t\t\t\tswitch(algorithm.hash.name.toUpperCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"SHA-1\":\r\n\t\t\t\t\t\tresult = \"1.2.840.113549.1.1.5\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-256\":\r\n\t\t\t\t\t\tresult = \"1.2.840.113549.1.1.11\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-384\":\r\n\t\t\t\t\t\tresult = \"1.2.840.113549.1.1.12\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-512\":\r\n\t\t\t\t\t\tresult = \"1.2.840.113549.1.1.13\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"RSA-PSS\":\r\n\t\t\t\tresult = \"1.2.840.113549.1.1.10\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"RSA-OAEP\":\r\n\t\t\t\tresult = \"1.2.840.113549.1.1.7\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ECDSA\":\r\n\t\t\t\tswitch(algorithm.hash.name.toUpperCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"SHA-1\":\r\n\t\t\t\t\t\tresult = \"1.2.840.10045.4.1\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-256\":\r\n\t\t\t\t\t\tresult = \"1.2.840.10045.4.3.2\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-384\":\r\n\t\t\t\t\t\tresult = \"1.2.840.10045.4.3.3\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-512\":\r\n\t\t\t\t\t\tresult = \"1.2.840.10045.4.3.4\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ECDH\":\r\n\t\t\t\tswitch(algorithm.kdf.toUpperCase()) // Non-standard addition - hash algorithm of KDF function\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"SHA-1\":\r\n\t\t\t\t\t\tresult = \"1.3.133.16.840.63.0.2\"; // dhSinglePass-stdDH-sha1kdf-scheme\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-256\":\r\n\t\t\t\t\t\tresult = \"1.3.132.1.11.1\"; // dhSinglePass-stdDH-sha256kdf-scheme\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-384\":\r\n\t\t\t\t\t\tresult = \"1.3.132.1.11.2\"; // dhSinglePass-stdDH-sha384kdf-scheme\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-512\":\r\n\t\t\t\t\t\tresult = \"1.3.132.1.11.3\"; // dhSinglePass-stdDH-sha512kdf-scheme\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"AES-CTR\":\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"AES-CBC\":\r\n\t\t\t\tswitch(algorithm.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 128:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.2\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 192:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.22\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 256:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.42\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"AES-CMAC\":\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"AES-GCM\":\r\n\t\t\t\tswitch(algorithm.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 128:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.6\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 192:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.26\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 256:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.46\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"AES-CFB\":\r\n\t\t\t\tswitch(algorithm.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 128:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.4\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 192:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.24\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 256:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.44\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"AES-KW\":\r\n\t\t\t\tswitch(algorithm.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 128:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.5\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 192:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.25\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 256:\r\n\t\t\t\t\t\tresult = \"2.16.840.1.101.3.4.1.45\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"HMAC\":\r\n\t\t\t\tswitch(algorithm.hash.name.toUpperCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"SHA-1\":\r\n\t\t\t\t\t\tresult = \"1.2.840.113549.2.7\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-256\":\r\n\t\t\t\t\t\tresult = \"1.2.840.113549.2.9\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-384\":\r\n\t\t\t\t\t\tresult = \"1.2.840.113549.2.10\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"SHA-512\":\r\n\t\t\t\t\t\tresult = \"1.2.840.113549.2.11\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"DH\":\r\n\t\t\t\tresult = \"1.2.840.113549.1.9.16.3.5\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"SHA-1\":\r\n\t\t\t\tresult = \"1.3.14.3.2.26\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"SHA-256\":\r\n\t\t\t\tresult = \"2.16.840.1.101.3.4.2.1\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"SHA-384\":\r\n\t\t\t\tresult = \"2.16.840.1.101.3.4.2.2\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"SHA-512\":\r\n\t\t\t\tresult = \"2.16.840.1.101.3.4.2.3\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"CONCAT\":\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"HKDF\":\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"PBKDF2\":\r\n\t\t\t\tresult = \"1.2.840.113549.1.5.12\";\r\n\t\t\t\tbreak;\r\n\t\t\t//region Special case - OIDs for ECC curves\r\n\t\t\tcase \"P-256\":\r\n\t\t\t\tresult = \"1.2.840.10045.3.1.7\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"P-384\":\r\n\t\t\t\tresult = \"1.3.132.0.34\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"P-521\":\r\n\t\t\t\tresult = \"1.3.132.0.35\";\r\n\t\t\t\tbreak;\r\n\t\t\t//endregion\r\n\t\t\tdefault:\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Get default algorithm parameters for each kind of operation\r\n\t * @param {string} algorithmName Algorithm name to get common parameters for\r\n\t * @param {string} operation Kind of operation: \"sign\", \"encrypt\", \"generatekey\", \"importkey\", \"exportkey\", \"verify\"\r\n\t * @returns {*}\r\n\t */\r\n\tgetAlgorithmParameters(algorithmName, operation)\r\n\t{\r\n\t\tlet result = {\r\n\t\t\talgorithm: {},\r\n\t\t\tusages: []\r\n\t\t};\r\n\t\t\r\n\t\tswitch(algorithmName.toUpperCase())\r\n\t\t{\r\n\t\t\tcase \"RSASSA-PKCS1-V1_5\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"generatekey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"RSASSA-PKCS1-v1_5\",\r\n\t\t\t\t\t\t\t\tmodulusLength: 2048,\r\n\t\t\t\t\t\t\t\tpublicExponent: new Uint8Array([0x01, 0x00, 0x01]),\r\n\t\t\t\t\t\t\t\thash: {\r\n\t\t\t\t\t\t\t\t\tname: \"SHA-256\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"sign\", \"verify\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"verify\":\r\n\t\t\t\t\tcase \"sign\":\r\n\t\t\t\t\tcase \"importkey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"RSASSA-PKCS1-v1_5\",\r\n\t\t\t\t\t\t\t\thash: {\r\n\t\t\t\t\t\t\t\t\tname: \"SHA-256\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"verify\"] // For importKey(\"pkcs8\") usage must be \"sign\" only\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"exportkey\":\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"RSASSA-PKCS1-v1_5\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"RSA-PSS\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"sign\":\r\n\t\t\t\t\tcase \"verify\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"RSA-PSS\",\r\n\t\t\t\t\t\t\t\thash: {\r\n\t\t\t\t\t\t\t\t\tname: \"SHA-1\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tsaltLength: 20\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"sign\", \"verify\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"generatekey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"RSA-PSS\",\r\n\t\t\t\t\t\t\t\tmodulusLength: 2048,\r\n\t\t\t\t\t\t\t\tpublicExponent: new Uint8Array([0x01, 0x00, 0x01]),\r\n\t\t\t\t\t\t\t\thash: {\r\n\t\t\t\t\t\t\t\t\tname: \"SHA-1\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"sign\", \"verify\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"importkey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"RSA-PSS\",\r\n\t\t\t\t\t\t\t\thash: {\r\n\t\t\t\t\t\t\t\t\tname: \"SHA-1\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"verify\"] // For importKey(\"pkcs8\") usage must be \"sign\" only\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"exportkey\":\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"RSA-PSS\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"RSA-OAEP\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"encrypt\":\r\n\t\t\t\t\tcase \"decrypt\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"RSA-OAEP\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\", \"decrypt\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"generatekey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"RSA-OAEP\",\r\n\t\t\t\t\t\t\t\tmodulusLength: 2048,\r\n\t\t\t\t\t\t\t\tpublicExponent: new Uint8Array([0x01, 0x00, 0x01]),\r\n\t\t\t\t\t\t\t\thash: {\r\n\t\t\t\t\t\t\t\t\tname: \"SHA-256\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\", \"decrypt\", \"wrapKey\", \"unwrapKey\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"importkey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"RSA-OAEP\",\r\n\t\t\t\t\t\t\t\thash: {\r\n\t\t\t\t\t\t\t\t\tname: \"SHA-256\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\"] // encrypt for \"spki\" and decrypt for \"pkcs8\"\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"exportkey\":\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"RSA-OAEP\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ECDSA\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"generatekey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"ECDSA\",\r\n\t\t\t\t\t\t\t\tnamedCurve: \"P-256\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"sign\", \"verify\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"importkey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"ECDSA\",\r\n\t\t\t\t\t\t\t\tnamedCurve: \"P-256\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"verify\"] // \"sign\" for \"pkcs8\"\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"verify\":\r\n\t\t\t\t\tcase \"sign\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"ECDSA\",\r\n\t\t\t\t\t\t\t\thash: {\r\n\t\t\t\t\t\t\t\t\tname: \"SHA-256\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"sign\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"ECDSA\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ECDH\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"exportkey\":\r\n\t\t\t\t\tcase \"importkey\":\r\n\t\t\t\t\tcase \"generatekey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"ECDH\",\r\n\t\t\t\t\t\t\t\tnamedCurve: \"P-256\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"deriveKey\", \"deriveBits\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"derivekey\":\r\n\t\t\t\t\tcase \"derivebits\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"ECDH\",\r\n\t\t\t\t\t\t\t\tnamedCurve: \"P-256\",\r\n\t\t\t\t\t\t\t\tpublic: [] // Must be a \"publicKey\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\", \"decrypt\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"ECDH\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"AES-CTR\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"importkey\":\r\n\t\t\t\t\tcase \"exportkey\":\r\n\t\t\t\t\tcase \"generatekey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"AES-CTR\",\r\n\t\t\t\t\t\t\t\tlength: 256\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\", \"decrypt\", \"wrapKey\", \"unwrapKey\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"decrypt\":\r\n\t\t\t\t\tcase \"encrypt\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"AES-CTR\",\r\n\t\t\t\t\t\t\t\tcounter: new Uint8Array(16),\r\n\t\t\t\t\t\t\t\tlength: 10\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\", \"decrypt\", \"wrapKey\", \"unwrapKey\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"AES-CTR\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"AES-CBC\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"importkey\":\r\n\t\t\t\t\tcase \"exportkey\":\r\n\t\t\t\t\tcase \"generatekey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"AES-CBC\",\r\n\t\t\t\t\t\t\t\tlength: 256\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\", \"decrypt\", \"wrapKey\", \"unwrapKey\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"decrypt\":\r\n\t\t\t\t\tcase \"encrypt\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"AES-CBC\",\r\n\t\t\t\t\t\t\t\tiv: this.getRandomValues(new Uint8Array(16)) // For \"decrypt\" the value should be replaced with value got on \"encrypt\" step\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\", \"decrypt\", \"wrapKey\", \"unwrapKey\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"AES-CBC\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"AES-GCM\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"importkey\":\r\n\t\t\t\t\tcase \"exportkey\":\r\n\t\t\t\t\tcase \"generatekey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"AES-GCM\",\r\n\t\t\t\t\t\t\t\tlength: 256\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\", \"decrypt\", \"wrapKey\", \"unwrapKey\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"decrypt\":\r\n\t\t\t\t\tcase \"encrypt\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"AES-GCM\",\r\n\t\t\t\t\t\t\t\tiv: this.getRandomValues(new Uint8Array(16)) // For \"decrypt\" the value should be replaced with value got on \"encrypt\" step\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\", \"decrypt\", \"wrapKey\", \"unwrapKey\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"AES-GCM\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"AES-KW\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"importkey\":\r\n\t\t\t\t\tcase \"exportkey\":\r\n\t\t\t\t\tcase \"generatekey\":\r\n\t\t\t\t\tcase \"wrapkey\":\r\n\t\t\t\t\tcase \"unwrapkey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"AES-KW\",\r\n\t\t\t\t\t\t\t\tlength: 256\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"wrapKey\", \"unwrapKey\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"AES-KW\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"HMAC\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"sign\":\r\n\t\t\t\t\tcase \"verify\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"HMAC\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"sign\", \"verify\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"importkey\":\r\n\t\t\t\t\tcase \"exportkey\":\r\n\t\t\t\t\tcase \"generatekey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"HMAC\",\r\n\t\t\t\t\t\t\t\tlength: 32,\r\n\t\t\t\t\t\t\t\thash: {\r\n\t\t\t\t\t\t\t\t\tname: \"SHA-256\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"sign\", \"verify\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"HMAC\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"HKDF\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"derivekey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"HKDF\",\r\n\t\t\t\t\t\t\t\thash: \"SHA-256\",\r\n\t\t\t\t\t\t\t\tsalt: new Uint8Array([]),\r\n\t\t\t\t\t\t\t\tinfo: new Uint8Array([])\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\", \"decrypt\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"HKDF\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"PBKDF2\":\r\n\t\t\t\tswitch(operation.toLowerCase())\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"derivekey\":\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"PBKDF2\",\r\n\t\t\t\t\t\t\t\thash: { name: \"SHA-256\" },\r\n\t\t\t\t\t\t\t\tsalt: new Uint8Array([]),\r\n\t\t\t\t\t\t\t\titerations: 10000\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: [\"encrypt\", \"decrypt\"]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\talgorithm: {\r\n\t\t\t\t\t\t\t\tname: \"PBKDF2\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tusages: []\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getting hash algorithm by signature algorithm\r\n\t * @param {AlgorithmIdentifier} signatureAlgorithm Signature algorithm\r\n\t * @returns {string}\r\n\t */\r\n\tgetHashAlgorithm(signatureAlgorithm)\r\n\t{\r\n\t\tlet result = \"\";\r\n\t\t\r\n\t\tswitch(signatureAlgorithm.algorithmId)\r\n\t\t{\r\n\t\t\tcase \"1.2.840.10045.4.1\": // ecdsa-with-SHA1\r\n\t\t\tcase \"1.2.840.113549.1.1.5\":\r\n\t\t\t\tresult = \"SHA-1\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"1.2.840.10045.4.3.2\": // ecdsa-with-SHA256\r\n\t\t\tcase \"1.2.840.113549.1.1.11\":\r\n\t\t\t\tresult = \"SHA-256\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"1.2.840.10045.4.3.3\": // ecdsa-with-SHA384\r\n\t\t\tcase \"1.2.840.113549.1.1.12\":\r\n\t\t\t\tresult = \"SHA-384\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"1.2.840.10045.4.3.4\": // ecdsa-with-SHA512\r\n\t\t\tcase \"1.2.840.113549.1.1.13\":\r\n\t\t\t\tresult = \"SHA-512\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"1.2.840.113549.1.1.10\": // RSA-PSS\r\n\t\t\t\t{\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst params = new RSASSAPSSParams({ schema: signatureAlgorithm.algorithmParams });\r\n\t\t\t\t\t\tif(\"hashAlgorithm\" in params)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconst algorithm = this.getAlgorithmByOID(params.hashAlgorithm.algorithmId);\r\n\t\t\t\t\t\t\tif((\"name\" in algorithm) === false)\r\n\t\t\t\t\t\t\t\treturn \"\";\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tresult = algorithm.name;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tresult = \"SHA-1\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(ex)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Specialized function encrypting \"EncryptedContentInfo\" object using parameters\r\n\t * @param {Object} parameters\r\n\t * @returns {Promise}\r\n\t */\r\n\tencryptEncryptedContentInfo(parameters)\r\n\t{\r\n\t\t//region Check for input parameters\r\n\t\tif((parameters instanceof Object) === false)\r\n\t\t\treturn Promise.reject(\"Parameters must have type \\\"Object\\\"\");\r\n\t\t\r\n\t\tif((\"password\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"password\\\"\");\r\n\t\t\r\n\t\tif((\"contentEncryptionAlgorithm\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"contentEncryptionAlgorithm\\\"\");\r\n\t\t\r\n\t\tif((\"hmacHashAlgorithm\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"hmacHashAlgorithm\\\"\");\r\n\t\t\r\n\t\tif((\"iterationCount\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"iterationCount\\\"\");\r\n\t\t\r\n\t\tif((\"contentToEncrypt\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"contentToEncrypt\\\"\");\r\n\t\t\r\n\t\tif((\"contentType\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"contentType\\\"\");\r\n\r\n\t\tconst contentEncryptionOID = this.getOIDByAlgorithm(parameters.contentEncryptionAlgorithm);\r\n\t\tif(contentEncryptionOID === \"\")\r\n\t\t\treturn Promise.reject(\"Wrong \\\"contentEncryptionAlgorithm\\\" value\");\r\n\t\t\r\n\t\tconst pbkdf2OID = this.getOIDByAlgorithm({\r\n\t\t\tname: \"PBKDF2\"\r\n\t\t});\r\n\t\tif(pbkdf2OID === \"\")\r\n\t\t\treturn Promise.reject(\"Can not find OID for PBKDF2\");\r\n\t\t\r\n\t\tconst hmacOID = this.getOIDByAlgorithm({\r\n\t\t\tname: \"HMAC\",\r\n\t\t\thash: {\r\n\t\t\t\tname: parameters.hmacHashAlgorithm\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(hmacOID === \"\")\r\n\t\t\treturn Promise.reject(`Incorrect value for \"hmacHashAlgorithm\": ${parameters.hmacHashAlgorithm}`);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet sequence = Promise.resolve();\r\n\t\t\r\n\t\tconst ivBuffer = new ArrayBuffer(16); // For AES we need IV 16 bytes long\r\n\t\tconst ivView = new Uint8Array(ivBuffer);\r\n\t\tthis.getRandomValues(ivView);\r\n\t\t\r\n\t\tconst saltBuffer = new ArrayBuffer(64);\r\n\t\tconst saltView = new Uint8Array(saltBuffer);\r\n\t\tthis.getRandomValues(saltView);\r\n\t\t\r\n\t\tconst contentView = new Uint8Array(parameters.contentToEncrypt);\r\n\t\t\r\n\t\tconst pbkdf2Params = new PBKDF2Params({\r\n\t\t\tsalt: new asn1js.OctetString({ valueHex: saltBuffer }),\r\n\t\t\titerationCount: parameters.iterationCount,\r\n\t\t\tprf: new AlgorithmIdentifier({\r\n\t\t\t\talgorithmId: hmacOID,\r\n\t\t\t\talgorithmParams: new asn1js.Null()\r\n\t\t\t})\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Derive PBKDF2 key from \"password\" buffer\r\n\t\tsequence = sequence.then(() =>\r\n\t\t{\r\n\t\t\tconst passwordView = new Uint8Array(parameters.password);\r\n\t\t\t\r\n\t\t\treturn this.importKey(\"raw\",\r\n\t\t\t\tpasswordView,\r\n\t\t\t\t\"PBKDF2\",\r\n\t\t\t\tfalse,\r\n\t\t\t\t[\"deriveKey\"]);\r\n\t\t}, error =>\r\n\t\t\tPromise.reject(error)\r\n\t\t);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Derive key for \"contentEncryptionAlgorithm\"\r\n\t\tsequence = sequence.then(result =>\r\n\t\t\tthis.deriveKey({\r\n\t\t\t\tname: \"PBKDF2\",\r\n\t\t\t\thash: {\r\n\t\t\t\t\tname: parameters.hmacHashAlgorithm\r\n\t\t\t\t},\r\n\t\t\t\tsalt: saltView,\r\n\t\t\t\titerations: parameters.iterationCount\r\n\t\t\t},\r\n\t\t\tresult,\r\n\t\t\tparameters.contentEncryptionAlgorithm,\r\n\t\t\tfalse,\r\n\t\t\t[\"encrypt\"]),\r\n\t\terror =>\r\n\t\t\tPromise.reject(error)\r\n\t\t);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Encrypt content\r\n\t\tsequence = sequence.then(result =>\r\n\t\t\tthis.encrypt({\r\n\t\t\t\tname: parameters.contentEncryptionAlgorithm.name,\r\n\t\t\t\tiv: ivView\r\n\t\t\t},\r\n\t\t\tresult,\r\n\t\t\tcontentView),\r\n\t\terror =>\r\n\t\t\tPromise.reject(error)\r\n\t\t);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Store all parameters in EncryptedData object\r\n\t\tsequence = sequence.then(result =>\r\n\t\t{\r\n\t\t\tconst pbes2Parameters = new PBES2Params({\r\n\t\t\t\tkeyDerivationFunc: new AlgorithmIdentifier({\r\n\t\t\t\t\talgorithmId: pbkdf2OID,\r\n\t\t\t\t\talgorithmParams: pbkdf2Params.toSchema()\r\n\t\t\t\t}),\r\n\t\t\t\tencryptionScheme: new AlgorithmIdentifier({\r\n\t\t\t\t\talgorithmId: contentEncryptionOID,\r\n\t\t\t\t\talgorithmParams: new asn1js.OctetString({ valueHex: ivBuffer })\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\treturn new EncryptedContentInfo({\r\n\t\t\t\tcontentType: parameters.contentType,\r\n\t\t\t\tcontentEncryptionAlgorithm: new AlgorithmIdentifier({\r\n\t\t\t\t\talgorithmId: \"1.2.840.113549.1.5.13\", // pkcs5PBES2\r\n\t\t\t\t\talgorithmParams: pbes2Parameters.toSchema()\r\n\t\t\t\t}),\r\n\t\t\t\tencryptedContent: new asn1js.OctetString({ valueHex: result })\r\n\t\t\t});\r\n\t\t}, error =>\r\n\t\t\tPromise.reject(error)\r\n\t\t);\r\n\t\t//endregion\r\n\r\n\t\treturn sequence;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Decrypt data stored in \"EncryptedContentInfo\" object using parameters\r\n\t * @param parameters\r\n\t * @return {Promise}\r\n\t */\r\n\tdecryptEncryptedContentInfo(parameters)\r\n\t{\r\n\t\t//region Check for input parameters\r\n\t\tif((parameters instanceof Object) === false)\r\n\t\t\treturn Promise.reject(\"Parameters must have type \\\"Object\\\"\");\r\n\t\t\r\n\t\tif((\"password\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"password\\\"\");\r\n\t\t\r\n\t\tif((\"encryptedContentInfo\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"encryptedContentInfo\\\"\");\r\n\r\n\t\tif(parameters.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId !== \"1.2.840.113549.1.5.13\") // pkcs5PBES2\r\n\t\t\treturn Promise.reject(`Unknown \"contentEncryptionAlgorithm\": ${parameters.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet sequence = Promise.resolve();\r\n\t\t\r\n\t\tlet pbes2Parameters;\r\n\t\t\r\n\t\ttry\r\n\t\t{\r\n\t\t\tpbes2Parameters = new PBES2Params({ schema: parameters.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams });\r\n\t\t}\r\n\t\tcatch(ex)\r\n\t\t{\r\n\t\t\treturn Promise.reject(\"Incorrectly encoded \\\"pbes2Parameters\\\"\");\r\n\t\t}\r\n\t\t\r\n\t\tlet pbkdf2Params;\r\n\t\t\r\n\t\ttry\r\n\t\t{\r\n\t\t\tpbkdf2Params = new PBKDF2Params({ schema: pbes2Parameters.keyDerivationFunc.algorithmParams });\r\n\t\t}\r\n\t\tcatch(ex)\r\n\t\t{\r\n\t\t\treturn Promise.reject(\"Incorrectly encoded \\\"pbkdf2Params\\\"\");\r\n\t\t}\r\n\t\t\r\n\t\tconst contentEncryptionAlgorithm = this.getAlgorithmByOID(pbes2Parameters.encryptionScheme.algorithmId);\r\n\t\tif((\"name\" in contentEncryptionAlgorithm) === false)\r\n\t\t\treturn Promise.reject(`Incorrect OID for \"contentEncryptionAlgorithm\": ${pbes2Parameters.encryptionScheme.algorithmId}`);\r\n\t\t\r\n\t\tconst ivBuffer = pbes2Parameters.encryptionScheme.algorithmParams.valueBlock.valueHex;\r\n\t\tconst ivView = new Uint8Array(ivBuffer);\r\n\t\t\r\n\t\tconst saltBuffer = pbkdf2Params.salt.valueBlock.valueHex;\r\n\t\tconst saltView = new Uint8Array(saltBuffer);\r\n\t\t\r\n\t\tconst iterationCount = pbkdf2Params.iterationCount;\r\n\t\t\r\n\t\tlet hmacHashAlgorithm = \"SHA-1\";\r\n\t\t\r\n\t\tif(\"prf\" in pbkdf2Params)\r\n\t\t{\r\n\t\t\tconst algorithm = this.getAlgorithmByOID(pbkdf2Params.prf.algorithmId);\r\n\t\t\tif((\"name\" in algorithm) === false)\r\n\t\t\t\treturn Promise.reject(\"Incorrect OID for HMAC hash algorithm\");\r\n\t\t\t\r\n\t\t\thmacHashAlgorithm = algorithm.hash.name;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Derive PBKDF2 key from \"password\" buffer\r\n\t\tsequence = sequence.then(() =>\r\n\t\t\tthis.importKey(\"raw\",\r\n\t\t\t\tparameters.password,\r\n\t\t\t\t\"PBKDF2\",\r\n\t\t\t\tfalse,\r\n\t\t\t\t[\"deriveKey\"]),\r\n\t\terror =>\r\n\t\t\tPromise.reject(error)\r\n\t\t);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Derive key for \"contentEncryptionAlgorithm\"\r\n\t\tsequence = sequence.then(result =>\r\n\t\t\tthis.deriveKey({\r\n\t\t\t\tname: \"PBKDF2\",\r\n\t\t\t\thash: {\r\n\t\t\t\t\tname: hmacHashAlgorithm\r\n\t\t\t\t},\r\n\t\t\t\tsalt: saltView,\r\n\t\t\t\titerations: iterationCount\r\n\t\t\t},\r\n\t\t\tresult,\r\n\t\t\tcontentEncryptionAlgorithm,\r\n\t\t\tfalse,\r\n\t\t\t[\"decrypt\"]),\r\n\t\terror =>\r\n\t\t\tPromise.reject(error)\r\n\t\t);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Decrypt internal content using derived key\r\n\t\tsequence = sequence.then(result =>\r\n\t\t{\r\n\t\t\t//region Create correct data block for decryption\r\n\t\t\tlet dataBuffer = new ArrayBuffer(0);\r\n\t\t\t\r\n\t\t\tif(parameters.encryptedContentInfo.encryptedContent.idBlock.isConstructed === false)\r\n\t\t\t\tdataBuffer = parameters.encryptedContentInfo.encryptedContent.valueBlock.valueHex;\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor(const content of parameters.encryptedContentInfo.encryptedContent.valueBlock.value)\r\n\t\t\t\t\tdataBuffer = utilConcatBuf(dataBuffer, content.valueBlock.valueHex);\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\treturn this.decrypt({\r\n\t\t\t\tname: contentEncryptionAlgorithm.name,\r\n\t\t\t\tiv: ivView\r\n\t\t\t},\r\n\t\t\tresult,\r\n\t\t\tdataBuffer);\r\n\t\t}, error =>\r\n\t\t\tPromise.reject(error)\r\n\t\t);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn sequence;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Stamping (signing) data using algorithm simular to HMAC\r\n\t * @param {Object} parameters\r\n\t * @return {Promise.<T>|Promise}\r\n\t */\r\n\tstampDataWithPassword(parameters)\r\n\t{\r\n\t\t//region Check for input parameters\r\n\t\tif((parameters instanceof Object) === false)\r\n\t\t\treturn Promise.reject(\"Parameters must have type \\\"Object\\\"\");\r\n\t\t\r\n\t\tif((\"password\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"password\\\"\");\r\n\t\t\r\n\t\tif((\"hashAlgorithm\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"hashAlgorithm\\\"\");\r\n\t\t\r\n\t\tif((\"salt\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"iterationCount\\\"\");\r\n\t\t\r\n\t\tif((\"iterationCount\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"salt\\\"\");\r\n\t\t\r\n\t\tif((\"contentToStamp\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"contentToStamp\\\"\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Choose correct length for HMAC key\r\n\t\tlet length;\r\n\t\t\r\n\t\tswitch(parameters.hashAlgorithm.toLowerCase())\r\n\t\t{\r\n\t\t\tcase \"sha-1\":\r\n\t\t\t\tlength = 160;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sha-256\":\r\n\t\t\t\tlength = 256;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sha-384\":\r\n\t\t\t\tlength = 384;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sha-512\":\r\n\t\t\t\tlength = 512;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\treturn Promise.reject(`Incorrect \"parameters.hashAlgorithm\" parameter: ${parameters.hashAlgorithm}`);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet sequence = Promise.resolve();\r\n\t\t\r\n\t\tconst hmacAlgorithm = {\r\n\t\t\tname: \"HMAC\",\r\n\t\t\tlength,\r\n\t\t\thash: {\r\n\t\t\t\tname: parameters.hashAlgorithm\r\n\t\t\t}\r\n\t\t};\r\n\t\t//endregion\r\n\r\n\t\t//region Create PKCS#12 key for integrity checking\r\n\t\tsequence = sequence.then(() => makePKCS12B2Key(this, parameters.hashAlgorithm, length, parameters.password, parameters.salt, parameters.iterationCount));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Import HMAC key\r\n\t\t// noinspection JSCheckFunctionSignatures\r\n\t\tsequence = sequence.then(\r\n\t\t\tresult =>\r\n\t\t\t\tthis.importKey(\"raw\",\r\n\t\t\t\t\tnew Uint8Array(result),\r\n\t\t\t\t\thmacAlgorithm,\r\n\t\t\t\t\tfalse,\r\n\t\t\t\t\t[\"sign\"])\r\n\t\t);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Make signed HMAC value\r\n\t\tsequence = sequence.then(\r\n\t\t\tresult =>\r\n\t\t\t\tthis.sign(hmacAlgorithm, result, new Uint8Array(parameters.contentToStamp)),\r\n\t\t\terror => Promise.reject(error)\r\n\t\t);\r\n\t\t//endregion\r\n\r\n\t\treturn sequence;\r\n\t}\r\n\t//**********************************************************************************\r\n\tverifyDataStampedWithPassword(parameters)\r\n\t{\r\n\t\t//region Check for input parameters\r\n\t\tif((parameters instanceof Object) === false)\r\n\t\t\treturn Promise.reject(\"Parameters must have type \\\"Object\\\"\");\r\n\t\t\r\n\t\tif((\"password\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"password\\\"\");\r\n\t\t\r\n\t\tif((\"hashAlgorithm\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"hashAlgorithm\\\"\");\r\n\t\t\r\n\t\tif((\"salt\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"iterationCount\\\"\");\r\n\t\t\r\n\t\tif((\"iterationCount\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"salt\\\"\");\r\n\t\t\r\n\t\tif((\"contentToVerify\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"contentToVerify\\\"\");\r\n\t\t\r\n\t\tif((\"signatureToVerify\" in parameters) === false)\r\n\t\t\treturn Promise.reject(\"Absent mandatory parameter \\\"signatureToVerify\\\"\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Choose correct length for HMAC key\r\n\t\tlet length;\r\n\t\t\r\n\t\tswitch(parameters.hashAlgorithm.toLowerCase())\r\n\t\t{\r\n\t\t\tcase \"sha-1\":\r\n\t\t\t\tlength = 160;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sha-256\":\r\n\t\t\t\tlength = 256;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sha-384\":\r\n\t\t\t\tlength = 384;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sha-512\":\r\n\t\t\t\tlength = 512;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\treturn Promise.reject(`Incorrect \"parameters.hashAlgorithm\" parameter: ${parameters.hashAlgorithm}`);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet sequence = Promise.resolve();\r\n\t\t\r\n\t\tconst hmacAlgorithm = {\r\n\t\t\tname: \"HMAC\",\r\n\t\t\tlength,\r\n\t\t\thash: {\r\n\t\t\t\tname: parameters.hashAlgorithm\r\n\t\t\t}\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create PKCS#12 key for integrity checking\r\n\t\tsequence = sequence.then(() => makePKCS12B2Key(this, parameters.hashAlgorithm, length, parameters.password, parameters.salt, parameters.iterationCount));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Import HMAC key\r\n\t\t// noinspection JSCheckFunctionSignatures\r\n\t\tsequence = sequence.then(result =>\r\n\t\t\tthis.importKey(\"raw\",\r\n\t\t\t\tnew Uint8Array(result),\r\n\t\t\t\thmacAlgorithm,\r\n\t\t\t\tfalse,\r\n\t\t\t\t[\"verify\"])\r\n\t\t);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Make signed HMAC value\r\n\t\tsequence = sequence.then(\r\n\t\t\tresult =>\r\n\t\t\t\tthis.verify(hmacAlgorithm, result, new Uint8Array(parameters.signatureToVerify), new Uint8Array(parameters.contentToVerify)),\r\n\t\t\terror => Promise.reject(error)\r\n\t\t);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn sequence;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Get signature parameters by analyzing private key algorithm\r\n\t * @param {Object} privateKey The private key user would like to use\r\n\t * @param {string} [hashAlgorithm=\"SHA-1\"] Hash algorithm user would like to use\r\n\t * @return {Promise.<T>|Promise}\r\n\t */\r\n\tgetSignatureParameters(privateKey, hashAlgorithm = \"SHA-1\")\r\n\t{\r\n\t\t//region Check hashing algorithm\r\n\t\tconst oid = this.getOIDByAlgorithm({ name: hashAlgorithm });\r\n\t\tif(oid === \"\")\r\n\t\t\treturn Promise.reject(`Unsupported hash algorithm: ${hashAlgorithm}`);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tconst signatureAlgorithm = new AlgorithmIdentifier();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Get a \"default parameters\" for current algorithm\r\n\t\tconst parameters = this.getAlgorithmParameters(privateKey.algorithm.name, \"sign\");\r\n\t\tparameters.algorithm.hash.name = hashAlgorithm;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Fill internal structures base on \"privateKey\" and \"hashAlgorithm\"\r\n\t\tswitch(privateKey.algorithm.name.toUpperCase())\r\n\t\t{\r\n\t\t\tcase \"RSASSA-PKCS1-V1_5\":\r\n\t\t\tcase \"ECDSA\":\r\n\t\t\t\tsignatureAlgorithm.algorithmId = this.getOIDByAlgorithm(parameters.algorithm);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"RSA-PSS\":\r\n\t\t\t\t{\r\n\t\t\t\t\t//region Set \"saltLength\" as a length (in octets) of hash function result\r\n\t\t\t\t\tswitch(hashAlgorithm.toUpperCase())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase \"SHA-256\":\r\n\t\t\t\t\t\t\tparameters.algorithm.saltLength = 32;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"SHA-384\":\r\n\t\t\t\t\t\t\tparameters.algorithm.saltLength = 48;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"SHA-512\":\r\n\t\t\t\t\t\t\tparameters.algorithm.saltLength = 64;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//endregion\r\n\t\t\t\t\t\r\n\t\t\t\t\t//region Fill \"RSASSA_PSS_params\" object\r\n\t\t\t\t\tconst paramsObject = {};\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(hashAlgorithm.toUpperCase() !== \"SHA-1\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst hashAlgorithmOID = this.getOIDByAlgorithm({ name: hashAlgorithm });\r\n\t\t\t\t\t\tif(hashAlgorithmOID === \"\")\r\n\t\t\t\t\t\t\treturn Promise.reject(`Unsupported hash algorithm: ${hashAlgorithm}`);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tparamsObject.hashAlgorithm = new AlgorithmIdentifier({\r\n\t\t\t\t\t\t\talgorithmId: hashAlgorithmOID,\r\n\t\t\t\t\t\t\talgorithmParams: new asn1js.Null()\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tparamsObject.maskGenAlgorithm = new AlgorithmIdentifier({\r\n\t\t\t\t\t\t\talgorithmId: \"1.2.840.113549.1.1.8\", // MGF1\r\n\t\t\t\t\t\t\talgorithmParams: paramsObject.hashAlgorithm.toSchema()\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(parameters.algorithm.saltLength !== 20)\r\n\t\t\t\t\t\tparamsObject.saltLength = parameters.algorithm.saltLength;\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst pssParameters = new RSASSAPSSParams(paramsObject);\r\n\t\t\t\t\t//endregion\r\n\t\t\t\t\t\r\n\t\t\t\t\t//region Automatically set signature algorithm\r\n\t\t\t\t\tsignatureAlgorithm.algorithmId = \"1.2.840.113549.1.1.10\";\r\n\t\t\t\t\tsignatureAlgorithm.algorithmParams = pssParameters.toSchema();\r\n\t\t\t\t\t//endregion\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\treturn Promise.reject(`Unsupported signature algorithm: ${privateKey.algorithm.name}`);\r\n\t\t}\r\n\t\t//endregion\r\n\r\n\t\treturn Promise.resolve().then(() => ({\r\n\t\t\tsignatureAlgorithm,\r\n\t\t\tparameters\r\n\t\t}));\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Sign data with pre-defined private key\r\n\t * @param {ArrayBuffer} data Data to be signed\r\n\t * @param {Object} privateKey Private key to use\r\n\t * @param {Object} parameters Parameters for used algorithm\r\n\t * @return {Promise.<T>|Promise}\r\n\t */\r\n\tsignWithPrivateKey(data, privateKey, parameters)\r\n\t{\r\n\t\treturn this.sign(parameters.algorithm,\r\n\t\t\tprivateKey,\r\n\t\t\tnew Uint8Array(data))\r\n\t\t\t.then(result =>\r\n\t\t\t{\r\n\t\t\t\t//region Special case for ECDSA algorithm\r\n\t\t\t\tif(parameters.algorithm.name === \"ECDSA\")\r\n\t\t\t\t\tresult = createCMSECDSASignature(result);\r\n\t\t\t\t//endregion\r\n\t\t\t\t\r\n\t\t\t\treturn result;\r\n\t\t\t}, error =>\r\n\t\t\t\tPromise.reject(`Signing error: ${error}`)\r\n\t\t\t);\r\n\t}\r\n\t//**********************************************************************************\r\n\tfillPublicKeyParameters(publicKeyInfo, signatureAlgorithm)\r\n\t{\r\n\t\tconst parameters = {};\r\n\t\t\r\n\t\t//region Find signer's hashing algorithm\r\n\t\tconst shaAlgorithm = this.getHashAlgorithm(signatureAlgorithm);\r\n\t\tif(shaAlgorithm === \"\")\r\n\t\t\treturn Promise.reject(`Unsupported signature algorithm: ${signatureAlgorithm.algorithmId}`);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Get information about public key algorithm and default parameters for import\r\n\t\tlet algorithmId;\r\n\t\tif(signatureAlgorithm.algorithmId === \"1.2.840.113549.1.1.10\")\r\n\t\t\talgorithmId = signatureAlgorithm.algorithmId;\r\n\t\telse\r\n\t\t\talgorithmId = publicKeyInfo.algorithm.algorithmId;\r\n\t\t\r\n\t\tconst algorithmObject = this.getAlgorithmByOID(algorithmId);\r\n\t\tif((\"name\" in algorithmObject) === \"\")\r\n\t\t\treturn Promise.reject(`Unsupported public key algorithm: ${signatureAlgorithm.algorithmId}`);\r\n\t\t\r\n\t\tparameters.algorithm = this.getAlgorithmParameters(algorithmObject.name, \"importkey\");\r\n\t\tif(\"hash\" in parameters.algorithm.algorithm)\r\n\t\t\tparameters.algorithm.algorithm.hash.name = shaAlgorithm;\r\n\t\t\r\n\t\t//region Special case for ECDSA\r\n\t\tif(algorithmObject.name === \"ECDSA\")\r\n\t\t{\r\n\t\t\t//region Get information about named curve\r\n\t\t\tlet algorithmParamsChecked = false;\r\n\t\t\t\r\n\t\t\tif((\"algorithmParams\" in publicKeyInfo.algorithm) === true)\r\n\t\t\t{\r\n\t\t\t\tif(\"idBlock\" in publicKeyInfo.algorithm.algorithmParams)\r\n\t\t\t\t{\r\n\t\t\t\t\tif((publicKeyInfo.algorithm.algorithmParams.idBlock.tagClass === 1) && (publicKeyInfo.algorithm.algorithmParams.idBlock.tagNumber === 6))\r\n\t\t\t\t\t\talgorithmParamsChecked = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(algorithmParamsChecked === false)\r\n\t\t\t\treturn Promise.reject(\"Incorrect type for ECDSA public key parameters\");\r\n\t\t\t\r\n\t\t\tconst curveObject = this.getAlgorithmByOID(publicKeyInfo.algorithm.algorithmParams.valueBlock.toString());\r\n\t\t\tif((\"name\" in curveObject) === false)\r\n\t\t\t\treturn Promise.reject(`Unsupported named curve algorithm: ${publicKeyInfo.algorithm.algorithmParams.valueBlock.toString()}`);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\tparameters.algorithm.algorithm.namedCurve = curveObject.name;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn parameters;\r\n\t}\r\n\t//**********************************************************************************\r\n\tgetPublicKey(publicKeyInfo, signatureAlgorithm, parameters = null)\r\n\t{\r\n\t\tif(parameters === null)\r\n\t\t\tparameters = this.fillPublicKeyParameters(publicKeyInfo, signatureAlgorithm);\r\n\t\t\r\n\t\tconst publicKeyInfoSchema = publicKeyInfo.toSchema();\r\n\t\tconst publicKeyInfoBuffer = publicKeyInfoSchema.toBER(false);\r\n\t\tconst publicKeyInfoView = new Uint8Array(publicKeyInfoBuffer);\r\n\t\t\r\n\t\treturn this.importKey(\"spki\",\r\n\t\t\tpublicKeyInfoView,\r\n\t\t\tparameters.algorithm.algorithm,\r\n\t\t\ttrue,\r\n\t\t\tparameters.algorithm.usages\r\n\t\t);\r\n\t}\r\n\t//**********************************************************************************\r\n\tverifyWithPublicKey(data, signature, publicKeyInfo, signatureAlgorithm, shaAlgorithm = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet sequence = Promise.resolve();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find signer's hashing algorithm\r\n\t\tif(shaAlgorithm === null)\r\n\t\t{\r\n\t\t\tshaAlgorithm = this.getHashAlgorithm(signatureAlgorithm);\r\n\t\t\tif(shaAlgorithm === \"\")\r\n\t\t\t\treturn Promise.reject(`Unsupported signature algorithm: ${signatureAlgorithm.algorithmId}`);\r\n\t\t\t\r\n\t\t\t//region Import public key\r\n\t\t\tsequence = sequence.then(() =>\r\n\t\t\t\tthis.getPublicKey(publicKeyInfo, signatureAlgorithm));\r\n\t\t\t//endregion\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tconst parameters = {};\r\n\t\t\t\r\n\t\t\t//region Get information about public key algorithm and default parameters for import\r\n\t\t\tlet algorithmId;\r\n\t\t\tif(signatureAlgorithm.algorithmId === \"1.2.840.113549.1.1.10\")\r\n\t\t\t\talgorithmId = signatureAlgorithm.algorithmId;\r\n\t\t\telse\r\n\t\t\t\talgorithmId = publicKeyInfo.algorithm.algorithmId;\r\n\t\t\t\r\n\t\t\tconst algorithmObject = this.getAlgorithmByOID(algorithmId);\r\n\t\t\tif((\"name\" in algorithmObject) === \"\")\r\n\t\t\t\treturn Promise.reject(`Unsupported public key algorithm: ${signatureAlgorithm.algorithmId}`);\r\n\t\t\t\r\n\t\t\tparameters.algorithm = this.getAlgorithmParameters(algorithmObject.name, \"importkey\");\r\n\t\t\tif(\"hash\" in parameters.algorithm.algorithm)\r\n\t\t\t\tparameters.algorithm.algorithm.hash.name = shaAlgorithm;\r\n\t\t\t\r\n\t\t\t//region Special case for ECDSA\r\n\t\t\tif(algorithmObject.name === \"ECDSA\")\r\n\t\t\t{\r\n\t\t\t\t//region Get information about named curve\r\n\t\t\t\tlet algorithmParamsChecked = false;\r\n\t\t\t\t\r\n\t\t\t\tif((\"algorithmParams\" in publicKeyInfo.algorithm) === true)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(\"idBlock\" in publicKeyInfo.algorithm.algorithmParams)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif((publicKeyInfo.algorithm.algorithmParams.idBlock.tagClass === 1) && (publicKeyInfo.algorithm.algorithmParams.idBlock.tagNumber === 6))\r\n\t\t\t\t\t\t\talgorithmParamsChecked = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(algorithmParamsChecked === false)\r\n\t\t\t\t\treturn Promise.reject(\"Incorrect type for ECDSA public key parameters\");\r\n\t\t\t\t\r\n\t\t\t\tconst curveObject = this.getAlgorithmByOID(publicKeyInfo.algorithm.algorithmParams.valueBlock.toString());\r\n\t\t\t\tif((\"name\" in curveObject) === false)\r\n\t\t\t\t\treturn Promise.reject(`Unsupported named curve algorithm: ${publicKeyInfo.algorithm.algorithmParams.valueBlock.toString()}`);\r\n\t\t\t\t//endregion\r\n\t\t\t\t\r\n\t\t\t\tparameters.algorithm.algorithm.namedCurve = curveObject.name;\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t//endregion\r\n\r\n\t\t\t//region Import public key\r\n\t\t\tsequence = sequence.then(() =>\r\n\t\t\t\tthis.getPublicKey(publicKeyInfo, null, parameters));\r\n\t\t\t//endregion\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Verify signature\r\n\t\tsequence = sequence.then(publicKey =>\r\n\t\t{\r\n\t\t\t//region Get default algorithm parameters for verification\r\n\t\t\tconst algorithm = this.getAlgorithmParameters(publicKey.algorithm.name, \"verify\");\r\n\t\t\tif(\"hash\" in algorithm.algorithm)\r\n\t\t\t\talgorithm.algorithm.hash.name = shaAlgorithm;\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Special case for ECDSA signatures\r\n\t\t\tlet signatureValue = signature.valueBlock.valueHex;\r\n\t\t\t\r\n\t\t\tif(publicKey.algorithm.name === \"ECDSA\")\r\n\t\t\t{\r\n\t\t\t\tconst asn1 = asn1js.fromBER(signatureValue);\r\n\t\t\t\t// noinspection JSCheckFunctionSignatures\r\n\t\t\t\tsignatureValue = createECDSASignatureFromCMS(asn1.result);\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Special case for RSA-PSS\r\n\t\t\tif(publicKey.algorithm.name === \"RSA-PSS\")\r\n\t\t\t{\r\n\t\t\t\tlet pssParameters;\r\n\t\t\t\t\r\n\t\t\t\ttry\r\n\t\t\t\t{\r\n\t\t\t\t\tpssParameters = new RSASSAPSSParams({ schema: signatureAlgorithm.algorithmParams });\r\n\t\t\t\t}\r\n\t\t\t\tcatch(ex)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn Promise.reject(ex);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(\"saltLength\" in pssParameters)\r\n\t\t\t\t\talgorithm.algorithm.saltLength = pssParameters.saltLength;\r\n\t\t\t\telse\r\n\t\t\t\t\talgorithm.algorithm.saltLength = 20;\r\n\t\t\t\t\r\n\t\t\t\tlet hashAlgo = \"SHA-1\";\r\n\t\t\t\t\r\n\t\t\t\tif(\"hashAlgorithm\" in pssParameters)\r\n\t\t\t\t{\r\n\t\t\t\t\tconst hashAlgorithm = this.getAlgorithmByOID(pssParameters.hashAlgorithm.algorithmId);\r\n\t\t\t\t\tif((\"name\" in hashAlgorithm) === false)\r\n\t\t\t\t\t\treturn Promise.reject(`Unrecognized hash algorithm: ${pssParameters.hashAlgorithm.algorithmId}`);\r\n\t\t\t\t\t\r\n\t\t\t\t\thashAlgo = hashAlgorithm.name;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\talgorithm.algorithm.hash.name = hashAlgo;\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\treturn this.verify(algorithm.algorithm,\r\n\t\t\t\tpublicKey,\r\n\t\t\t\tnew Uint8Array(signatureValue),\r\n\t\t\t\tnew Uint8Array(data)\r\n\t\t\t);\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn sequence;\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n"]}