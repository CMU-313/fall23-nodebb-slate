{"version":3,"sources":["../src/RSAPublicKey.js"],"names":["asn1js","RSAPublicKey","constructor","parameters","modulus","defaultValues","publicExponent","fromSchema","schema","fromJSON","json","memberName","Integer","Error","names","Sequence","name","blockName","value","asn1","compareSchema","verified","result","convertFromDER","toSchema","convertToDER","toJSON","n","valueBlock","valueHex","e","array","slice","Math","pow","byteLength"],"mappings":"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","file":"RSAPublicKey.js","sourcesContent":["import * as asn1js from \"asn1js\";\r\nimport { getParametersValue, toBase64, arrayBufferToString, stringToArrayBuffer, fromBase64, nearestPowerOf2, clearProps } from \"pvutils\";\r\n//**************************************************************************************\r\n/**\r\n * Class from RFC3447\r\n */\r\nexport default class RSAPublicKey\r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for RSAPublicKey class\r\n\t * @param {Object} [parameters={}]\r\n\t * @property {Object} [schema] asn1js parsed value\r\n\t * @property {Integer} [modulus]\r\n\t * @property {Integer} [publicExponent]\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t//region Internal properties of the object\r\n\t\t/**\r\n\t\t * @type {Integer}\r\n\t\t * @description Modulus part of RSA public key\r\n\t\t */\r\n\t\tthis.modulus = getParametersValue(parameters, \"modulus\", RSAPublicKey.defaultValues(\"modulus\"));\r\n\t\t/**\r\n\t\t * @type {Integer}\r\n\t\t * @description Public exponent of RSA public key\r\n\t\t */\r\n\t\tthis.publicExponent = getParametersValue(parameters, \"publicExponent\", RSAPublicKey.defaultValues(\"publicExponent\"));\r\n\t\t//endregion\r\n\r\n\t\t//region If input argument array contains \"schema\" for this object\r\n\t\tif(\"schema\" in parameters)\r\n\t\t\tthis.fromSchema(parameters.schema);\r\n\t\t//endregion\r\n\t\t//region If input argument array contains \"json\" for this object\r\n\t\tif(\"json\" in parameters)\r\n\t\t\tthis.fromJSON(parameters.json);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return default values for all class members\r\n\t * @param {string} memberName String name for a class member\r\n\t */\r\n\tstatic defaultValues(memberName)\r\n\t{\r\n\t\tswitch(memberName)\r\n\t\t{\r\n\t\t\tcase \"modulus\":\r\n\t\t\t\treturn new asn1js.Integer();\r\n\t\t\tcase \"publicExponent\":\r\n\t\t\t\treturn new asn1js.Integer();\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`Invalid member name for RSAPublicKey class: ${memberName}`);\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return value of asn1js schema for current class\r\n\t * @param {Object} parameters Input parameters for the schema\r\n\t * @returns {Object} asn1js schema object\r\n\t */\r\n\tstatic schema(parameters = {})\r\n\t{\r\n\t\t//RSAPublicKey ::= Sequence {\r\n\t\t//    modulus           Integer,  -- n\r\n\t\t//    publicExponent    Integer   -- e\r\n\t\t//}\r\n\r\n\t\t/**\r\n\t\t * @type {Object}\r\n\t\t * @property {string} utcTimeName Name for \"utcTimeName\" choice\r\n\t\t * @property {string} generalTimeName Name for \"generalTimeName\" choice\r\n\t\t */\r\n\t\tconst names = getParametersValue(parameters, \"names\", {});\r\n\r\n\t\treturn (new asn1js.Sequence({\r\n\t\t\tname: (names.blockName || \"\"),\r\n\t\t\tvalue: [\r\n\t\t\t\tnew asn1js.Integer({ name: (names.modulus || \"\") }),\r\n\t\t\t\tnew asn1js.Integer({ name: (names.publicExponent || \"\") })\r\n\t\t\t]\r\n\t\t}));\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert parsed asn1js object into current class\r\n\t * @param {!Object} schema\r\n\t */\r\n\tfromSchema(schema)\r\n\t{\r\n\t\t//region Clear input data first\r\n\t\tclearProps(schema, [\r\n\t\t\t\"modulus\",\r\n\t\t\t\"publicExponent\"\r\n\t\t]);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check the schema is valid\r\n\t\tconst asn1 = asn1js.compareSchema(schema,\r\n\t\t\tschema,\r\n\t\t\tRSAPublicKey.schema({\r\n\t\t\t\tnames: {\r\n\t\t\t\t\tmodulus: \"modulus\",\r\n\t\t\t\t\tpublicExponent: \"publicExponent\"\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tif(asn1.verified === false)\r\n\t\t\tthrow new Error(\"Object's schema was not verified against input data for RSAPublicKey\");\r\n\t\t//endregion\r\n\r\n\t\t//region Get internal properties from parsed schema\r\n\t\tthis.modulus = asn1.result.modulus.convertFromDER(256);\r\n\t\tthis.publicExponent = asn1.result.publicExponent;\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert current object to asn1js object and set correct values\r\n\t * @returns {Object} asn1js object\r\n\t */\r\n\ttoSchema()\r\n\t{\r\n\t\t//region Construct and return new ASN.1 schema for this object\r\n\t\treturn (new asn1js.Sequence({\r\n\t\t\tvalue: [\r\n\t\t\t\tthis.modulus.convertToDER(),\r\n\t\t\t\tthis.publicExponent\r\n\t\t\t]\r\n\t\t}));\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convertion for the class to JSON object\r\n\t * @returns {Object}\r\n\t */\r\n\ttoJSON()\r\n\t{\r\n\t\treturn {\r\n\t\t\tn: toBase64(arrayBufferToString(this.modulus.valueBlock.valueHex), true, true, true),\r\n\t\t\te: toBase64(arrayBufferToString(this.publicExponent.valueBlock.valueHex), true, true, true)\r\n\t\t};\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert JSON value into current object\r\n\t * @param {Object} json\r\n\t */\r\n\tfromJSON(json)\r\n\t{\r\n\t\tif(\"n\" in json)\r\n\t\t{\r\n\t\t\tconst array = stringToArrayBuffer(fromBase64(json.n, true));\r\n\t\t\tthis.modulus = new asn1js.Integer({ valueHex: array.slice(0, Math.pow(2, nearestPowerOf2(array.byteLength))) });\r\n\t\t}\r\n\t\telse\r\n\t\t\tthrow new Error(\"Absent mandatory parameter \\\"n\\\"\");\r\n\r\n\t\tif(\"e\" in json)\r\n\t\t\tthis.publicExponent = new asn1js.Integer({ valueHex: stringToArrayBuffer(fromBase64(json.e, true)).slice(0, 3) });\r\n\t\telse\r\n\t\t\tthrow new Error(\"Absent mandatory parameter \\\"e\\\"\");\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n"]}